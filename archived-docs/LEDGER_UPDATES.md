# Ledger 組件更新說明

## 🎉 新功能總覽

### 1. 📅 日曆視圖 (Calendar View)
- 以月曆網格呈現，直觀顯示每日收支狀況
- 紅點（morandi-rose）表示支出，綠點（morandi-sage）表示收入
- 點擊日期可以進入該日的詳細清單
- 當月日期高亮顯示，今日有特殊標記（藍色環圈）
- 支持顯示每日收支金額（桌面版）

### 2. 🔄 捲動自動收合 (Auto-Collapse)
- 當頁面向下捲動時，自動隱藏上方的「檢視模式切換」與「類別篩選」
- 只保留日期導航條，釋放手機版螢幕空間
- 向上捲動時自動展開回原狀
- 在頁面頂部時始終保持展開狀態
- 平滑的動畫過渡效果

### 3. 📊 收支趨勢圖表 (Bar Chart)
- 使用 recharts 庫實現的專業圖表
- 根據選擇的時間範圍（週、月、年），視覺化呈現收入與支出對比
- 週視圖：顯示每日數據，按星期幾標記
- 月視圖：顯示每日數據，按日期標記
- 年視圖：顯示每月數據，按月份標記
- 日視圖和日曆視圖不顯示圖表
- 支持隱私模式，數據自動遮蔽

### 4. 💰 統計卡片優化
- 重新設計的頂部統計區塊，更像是一個儀表板
- 三個統計卡片：收入、支出、結餘
- 右上角裝飾性色塊，hover 時有縮放效果
- 使用漸變背景色增強視覺層次
- 小圖標（TrendingUp, DollarSign）增加識別度

### 5. 📤 可收合面板
- 統計圖表區塊可以點擊收合，專注於查看下方的交易明細
- 日曆模式下默認隱藏統計面板
- 頂部導航欄新增圖表切換按鈕（BarChart2 icon）
- 收合時顯示「顯示統計圖表」按鈕提示
- 展開時底部顯示向上箭頭提示可以收合
- 平滑的高度和透明度過渡動畫

### 6. 🎨 UI 質感提升
- 採用更柔和的邊框、陰影與間距
- 優化了日期導航器的樣式
- 交易卡片 hover 效果更細膩（border-morandi-blue/20）
- 移動端日期標籤改為粘性定位的膠囊形狀
- 改進了空狀態的視覺設計
- 增強了按鈕的視覺反饋

## 🔧 技術實現

### App.tsx 更新
- 為主要捲動區域添加 `id="main-scroll-container"`
- 使 Ledger 組件可以偵測捲動事件

### Ledger.tsx 更新

#### 新增狀態
```typescript
const [showStats, setShowStats] = useState(true);
const [isHeaderExpanded, setIsHeaderExpanded] = useState(true);
```

#### 新增 ViewMode
```typescript
type ViewMode = 'day' | 'week' | 'month' | 'year' | 'calendar';
```

#### 新增圖表數據處理
- `chartData` useMemo：根據不同視圖模式生成圖表數據
- 使用 `eachDayOfInterval` 和 `eachMonthOfInterval` 生成時間序列
- 自動計算每個時間點的收入和支出

#### 新增日曆渲染函數
- `renderCalendar()`：渲染完整的月曆視圖
- 顯示週標題（Sun-Sat）
- 顯示整月的日期網格
- 計算每日收支並顯示指示器
- 點擊日期切換到日視圖

#### 捲動檢測
- 使用 `useEffect` 監聽 `main-scroll-container` 的捲動事件
- 設定 10px 的閾值避免抖動
- 向下捲動超過 50px 後開始自動收合

## 📱 響應式設計

### 桌面版 (md+)
- 完整顯示所有功能
- 統計卡片橫向排列
- 圖表使用完整高度
- 日曆顯示收支金額文字
- 時間軸顯示在左側

### 移動版
- 統計卡片保持三欄布局，但使用更小的字體
- 日期導航條自適應寬度
- 日曆只顯示點狀指示器
- 移動端專用的粘性日期標籤
- 隱藏桌面版的時間軸

## 🎯 使用方式

1. **切換視圖模式**：點擊頂部的「日/週/月/年/月曆」按鈕
2. **查看統計圖表**：點擊圖表圖標按鈕（BarChart2）切換顯示/隱藏
3. **日曆視圖**：點擊任意日期進入該日的詳細清單
4. **自動收合**：向下捲動頁面，標題區域自動收合節省空間
5. **類別篩選**：在展開狀態下可以選擇類別篩選

## 🚀 性能優化

- 使用 `useMemo` 緩存計算結果
- 圖表數據按需計算
- 條件渲染避免不必要的組件加載
- 使用 CSS transitions 實現流暢動畫

## 🌈 色彩系統

- **收入色**：morandi-sage (#A8B5A5)
- **支出色**：morandi-rose (#C9A8A5)
- **結餘色**：morandi-blue (#8FA5B5)
- **背景色**：paper (#F9F7F2)
- **文字色**：ink-900 (#1C1917)

## 📝 注意事項

1. 日曆視圖和日視圖不顯示趨勢圖表
2. 捲動收合功能需要 `main-scroll-container` 元素存在
3. 圖表依賴 recharts 庫（已在 package.json 中）
4. 所有金額計算支持隱私模式
