# ğŸ“± æ™ºæŠ•æ‰‹å¸³ - å®Œæ•´ç”¢å“è¨­è¨ˆæ–‡ä»¶

**ç‰ˆæœ¬**: 2.0  
**æ›´æ–°æ—¥æœŸ**: 2024-11-24  
**ç”¢å“å®šä½**: LINE Bot + Web é›™å¹³å°è²¡å‹™ç®¡ç†å·¥å…·

---

## ğŸ“– ç›®éŒ„

1. [ç”¢å“æ¦‚è¿°](#ç”¢å“æ¦‚è¿°)
2. [æ ¸å¿ƒç†å¿µ](#æ ¸å¿ƒç†å¿µ)
3. [ä½¿ç”¨è€…æµç¨‹](#ä½¿ç”¨è€…æµç¨‹)
4. [ç¶²é ç«¯è¨­è¨ˆ](#ç¶²é ç«¯è¨­è¨ˆ)
5. [LINE Bot è¨­è¨ˆ](#line-bot-è¨­è¨ˆ)
6. [åŠŸèƒ½æ•´åˆ](#åŠŸèƒ½æ•´åˆ)
7. [æŠ€è¡“æ¶æ§‹](#æŠ€è¡“æ¶æ§‹)
8. [å¯¦ä½œè·¯ç·šåœ–](#å¯¦ä½œè·¯ç·šåœ–)

---

## ğŸ¯ ç”¢å“æ¦‚è¿°

### ä»€éº¼æ˜¯æ™ºæŠ•æ‰‹å¸³ï¼Ÿ

æ™ºæŠ•æ‰‹å¸³æ˜¯ä¸€å€‹**é›™å¹³å°è²¡å‹™ç®¡ç†å·¥å…·**ï¼Œçµåˆï¼š
- **LINE Bot**ï¼šå¿«é€Ÿè¨˜å¸³ã€æŸ¥è©¢è‚¡åƒ¹ã€ç­–ç•¥è¨ˆç®—
- **Web App**ï¼šè©³ç´°è³‡æ–™æŸ¥çœ‹ã€åœ–è¡¨åˆ†æã€è³‡ç”¢ç®¡ç†

### æ ¸å¿ƒåŠŸèƒ½

```
ğŸ“ è¨˜å¸³
â”œâ”€ å¿«é€Ÿè¼¸å…¥ï¼ˆLINEï¼šå‚³è¨Šæ¯ / Webï¼šEnter éµï¼‰
â”œâ”€ æ™ºèƒ½åˆ†é¡ï¼ˆæ©Ÿå™¨å­¸ç¿’é æ¸¬ï¼‰
â””â”€ æ”¶æ”¯è¶¨å‹¢åœ–è¡¨

ğŸ’° æŠ•è³‡è¿½è¹¤
â”œâ”€ å°è‚¡ / ç¾è‚¡ / åŠ å¯†è²¨å¹£
â”œâ”€ å³æ™‚å ±åƒ¹åŒæ­¥ï¼ˆYahoo Financeï¼‰
â”œâ”€ æç›Šè¨ˆç®—èˆ‡è¦–è¦ºåŒ–
â””â”€ è²·å…¥/è³£å‡ºè¨˜éŒ„

ğŸ§® ç­–ç•¥è¨ˆç®—
â”œâ”€ å‡±åˆ©å…¬å¼ï¼ˆæœ€ä½³å€‰ä½ï¼‰
â”œâ”€ é¦¬ä¸æ ¼çˆ¾ï¼ˆåŠ ç¢¼ç­–ç•¥ï¼‰
â””â”€ é¢¨éšªç®¡ç†å»ºè­°
```

### ç›®æ¨™ä½¿ç”¨è€…

**ä¸»è¦ç”¨æˆ¶**ï¼š
- 25-35 æ­²ä¸Šç­æ—
- æœ‰æŠ•è³‡è‚¡ç¥¨/åŠ å¯†è²¨å¹£
- ç¿’æ…£ä½¿ç”¨ LINE
- éœ€è¦ç°¡å–®çš„è¨˜å¸³å·¥å…·

**ä½¿ç”¨å ´æ™¯**ï¼š
- æ—©ä¸Šé€šå‹¤ï¼šæ‰“é–‹ LINE Bot æŸ¥çœ‹æŒè‚¡æ¼²è·Œ
- åˆé¤æ™‚é–“ï¼šå¿«é€Ÿè¨˜å¸³ 120 å…ƒ
- æ™šä¸Šä¼‘æ¯ï¼šæ‰“é–‹ç¶²é æŸ¥çœ‹è©³ç´°åœ–è¡¨
- é€±æœ«åˆ†æï¼šæª¢è¦–æœˆåº¦æ”¶æ”¯å ±å‘Š

---

## ğŸ’¡ æ ¸å¿ƒç†å¿µ

### 1. **å¿«é€Ÿè¼¸å…¥ï¼Œæ·±åº¦åˆ†æ**

```
LINE Bot   â†’ å¿«é€Ÿè¨˜éŒ„ï¼ˆ10 ç§’å®Œæˆï¼‰
Web App    â†’ æ·±åº¦åˆ†æï¼ˆåœ–è¡¨ã€å ±è¡¨ï¼‰
```

### 2. **ä¸€æ¬¡è¨˜éŒ„ï¼Œå…©ç«¯åŒæ­¥**

```
åœ¨ LINE è¨˜å¸³
    â†“
å³æ™‚åŒæ­¥åˆ° Web
    â†“
Web ä¹Ÿèƒ½å³æ™‚çœ‹åˆ°
```

### 3. **æ¸›å°‘é»æ“Šï¼Œå¢åŠ æ·±åº¦**

```
æ”¹é€²å‰ï¼š4 å€‹å¹³è¡Œé é¢
[æ¦‚è¦½] [æŠ•è³‡] [è¨˜å¸³] [ç­–ç•¥]

æ”¹é€²å¾Œï¼š3 å€‹ä¸»è¦åŠŸèƒ½
[ğŸ  ä¸»é ] [ğŸ“ è¨˜å¸³] [ğŸ”§ å·¥å…·]

ä¸»é  = æ¦‚è¦½ + æŠ•è³‡ï¼ˆåˆä½µï¼‰
å·¥å…· = ç­–ç•¥è¨ˆç®— + è¨­å®š
```

### 4. **æ™ºèƒ½é æ¸¬ï¼Œé™ä½é¸æ“‡**

```
ä½¿ç”¨è€…ï¼š120
Botï¼šå·²è¨˜éŒ„åˆ°ã€Œé£²é£Ÿã€â† è‡ªå‹•é æ¸¬
     (å¦‚æœéŒ¯èª¤ï¼Œè«‹å›è¦†ï¼šæ”¹ç‚º äº¤é€š)
```

---

## ğŸ‘¥ ä½¿ç”¨è€…æµç¨‹

### æ–°ç”¨æˆ¶ Onboarding

#### **Step 1: æŠ•è³‡ç¯„åœè¨­å®šï¼ˆæ¼¸é€²å¼æ­éœ² Progressive Disclosureï¼‰**

```
ç¬¬ä¸€æ¬¡é–‹å•Ÿ LINE Bot / Web App
    â†“
Botï¼šã€ŒğŸ‘‹ æ­¡è¿ä½¿ç”¨æ™ºæŠ•æ‰‹å¸³ï¼
     
     è«‹å•æ‚¨ç›®å‰çš„æŠ•è³‡ç¯„åœæ˜¯ï¼Ÿ
     (å¯éš¨æ™‚åœ¨è¨­å®šä¸­æ›´æ”¹)
     
     [âœ…] ğŸ‡¹ğŸ‡¼ å°è‚¡ (é è¨­é–‹å•Ÿ)
     [   ] ğŸ‡ºğŸ‡¸ ç¾è‚¡ / ETF
     [   ] â‚¿ åŠ å¯†è²¨å¹£
     
     [ä¸‹ä¸€æ­¥]ã€
```

**ä¸‰ç¨®ä½¿ç”¨è€…é¡å‹çš„ä»‹é¢é©é…**ï¼š

```typescript
// Type A: ç´”å°è‚¡æˆ°å£« (Simple)
é¸æ“‡ï¼š[âœ… å°è‚¡]
çµæœï¼š
  - éš±è—æ‰€æœ‰ USD/USDT æ¬„ä½
  - é è¨­å»ºç«‹ã€Œç¾é‡‘éŒ¢åŒ…ã€ã€Œè­‰åˆ¸äº¤å‰²æˆ¶ã€(TWD)
  - è‚¡ç¥¨æœå°‹åªé¡¯ç¤ºå°è‚¡çµæœ
  - å¸³æˆ¶ç®¡ç†é é¢æ¥µç°¡åŒ–

// Type B: è¤‡å§”è¨—ç©å®¶ (Sub-brokerage) ğŸŒŸ å°ç£æœ€å¸¸è¦‹
é¸æ“‡ï¼š[âœ… å°è‚¡] [âœ… ç¾è‚¡]
çµæœï¼š
  - å¯æœå°‹å°è‚¡+ç¾è‚¡
  - é è¨­å»ºç«‹ã€Œè­‰åˆ¸äº¤å‰²æˆ¶ (TWD)ã€
  - è²·ç¾è‚¡æ™‚è‡ªå‹•è¨ˆç®—åŒ¯ç‡ï¼šUS$150 Ã— 32.5 = NT$4,875
  - ä¸éœ€è¦ç¶­è­·ã€Œå‡çš„ç¾é‡‘å¸³æˆ¶ã€

// Type C: é›™æ£²å¤§æˆ¶ (Pro)
é¸æ“‡ï¼š[âœ… å°è‚¡] [âœ… ç¾è‚¡] (æ‰‹å‹•æ–°å¢ USD å¸³æˆ¶)
çµæœï¼š
  - å¯é¸æ“‡å¤šå€‹æ‰£æ¬¾å¸³æˆ¶
  - è²· AAPL æ™‚å¯é¸ï¼š
    [ğŸ‡ºğŸ‡¸ Firstrade (USD)] æˆ– [ğŸ‡¹ğŸ‡¼ åœ‹æ³°è¤‡å§”è¨— (TWD)]
  - å®Œæ•´çš„åŒ¯ç‡è½‰æ›èˆ‡å¸³æˆ¶ç®¡ç†
```

#### **Step 2: æœ¬é‡‘è¨­å®š**

```
Botï¼šã€Œè«‹è¼¸å…¥ä½ çš„æŠ•è³‡æœ¬é‡‘ï¼ˆä¾‹å¦‚ï¼š100000ï¼‰ã€
    â†“
ç”¨æˆ¶ï¼š100000
    â†“
Botï¼šã€Œâœ… å·²è¨­å®šæœ¬é‡‘ NT$100,000
     å·²è‡ªå‹•å»ºç«‹é è¨­å¸³æˆ¶ï¼š
     â€¢ ğŸ’° ç¾é‡‘éŒ¢åŒ… (TWD)
     â€¢ ğŸ¦ è­‰åˆ¸äº¤å‰²æˆ¶ (TWD)
     
     å¯éš¨æ™‚åœ¨ã€Œå¸³æˆ¶ç®¡ç†ã€èª¿æ•´ã€
    â†“
é¡¯ç¤ºæ•™å­¸å¡ç‰‡ï¼š
  ğŸ“ è¨˜å¸³ï¼šå‚³é€ -120 å¿«é€Ÿè¨˜å¸³
  ğŸ’° è‚¡ç¥¨ï¼šå‚³é€ AAPL æŸ¥è©¢è‚¡åƒ¹
  ğŸ§® ç­–ç•¥ï¼šå‚³é€ã€Œå‡±åˆ©ã€è¨ˆç®—å€‰ä½
  ğŸŒ ç¶²ç«™ï¼šé»æ“ŠæŸ¥çœ‹å®Œæ•´è³‡æ–™
    â†“
é–‹å§‹ä½¿ç”¨
```

### æ—¥å¸¸ä½¿ç”¨æµç¨‹

#### **å ´æ™¯ 1ï¼šå¿«é€Ÿè¨˜å¸³**

```
ã€LINE Botã€‘
ç”¨æˆ¶ï¼š-120
    â†“
Botï¼šã€Œè«‹é¸æ“‡åˆ†é¡ã€
     [é£²é£Ÿ] [äº¤é€š] [è³¼ç‰©] [å¨›æ¨‚] [å…¶ä»–]
    â†“
ç”¨æˆ¶ï¼šé»æ“Š [é£²é£Ÿ]
    â†“
Botï¼šã€Œâœ… å·²è¨˜éŒ„
     -NT$120 (é£²é£Ÿ)
     æœ¬æœˆå·²æ”¯å‡º NT$8,340ã€
```

**å„ªåŒ–ç‰ˆï¼ˆæ™ºèƒ½é æ¸¬ï¼‰**ï¼š
```
ç”¨æˆ¶ï¼š-120
    â†“
Botï¼šã€Œâœ… å·²è¨˜éŒ„åˆ°ã€Œé£²é£Ÿã€
     å¦‚æœéŒ¯èª¤ï¼Œè«‹å›è¦†ï¼šæ”¹ç‚º [åˆ†é¡]
     æœ¬æœˆå·²æ”¯å‡º NT$8,340ã€
```

#### **å ´æ™¯ 2ï¼šæŸ¥è©¢è‚¡åƒ¹**

```
ã€LINE Botã€‘
ç”¨æˆ¶ï¼š2330
    â†“
Botï¼šèª¿ç”¨ Yahoo Finance API
    â†“
å›å‚³ Flex Message å¡ç‰‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‡¹ğŸ‡¼ å°ç©é›» (2330.TW)     â”‚
â”‚                         â”‚
â”‚ NT$650.00               â”‚
â”‚ +5.00 (+0.77%) ğŸŸ¢      â”‚
â”‚                         â”‚
â”‚ ğŸ“Š ç­–ç•¥å»ºè­°              â”‚
â”‚ â€¢ å‡±åˆ©å€‰ä½ï¼š15.2%        â”‚
â”‚ â€¢ å»ºè­°è²·å…¥ï¼š23 è‚¡        â”‚
â”‚ â€¢ é¦¬ä¸æ ¼çˆ¾é»ä½ï¼šNT$585   â”‚
â”‚                         â”‚
â”‚ [è²·å…¥] [è³£å‡º] [æŸ¥çœ‹è©³æƒ…] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **å ´æ™¯ 3ï¼šè²·å…¥è‚¡ç¥¨**

```
ã€LINE Botã€‘
ç”¨æˆ¶ï¼šé»æ“Š [è²·å…¥] æŒ‰éˆ•
    â†“
Botï¼šã€Œè«‹è¼¸å…¥è²·å…¥è‚¡æ•¸ï¼ˆä¾‹å¦‚ï¼š10ï¼‰ã€
    â†“
ç”¨æˆ¶ï¼š10
    â†“
Bot è¨ˆç®—ï¼š10 Ã— NT$650 = NT$6,500
    â†“
Botï¼šã€Œç¢ºèªè²·å…¥ï¼Ÿ
     è‚¡ç¥¨ï¼š2330.TW
     è‚¡æ•¸ï¼š10 è‚¡
     åƒ¹æ ¼ï¼šNT$650.00
     ç¸½æˆæœ¬ï¼šNT$6,500
     
     [ç¢ºèª] [å–æ¶ˆ]ã€
    â†“
ç”¨æˆ¶ï¼šé»æ“Š [ç¢ºèª]
    â†“
Botï¼šã€Œâœ… è²·å…¥æˆåŠŸï¼
     å·²æŒæœ‰ 2330.TW
     â€¢ æ•¸é‡ï¼š10 è‚¡
     â€¢ æˆæœ¬ï¼šNT$650.00
     â€¢ å¸‚å€¼ï¼šNT$6,500
     
     ğŸ’¡ ä¸‹æ¬¡å¯ä»¥ç›´æ¥å‚³ã€Œ2330ã€æŸ¥çœ‹æŒè‚¡ã€
```

#### **å ´æ™¯ 4ï¼šæŸ¥çœ‹å®Œæ•´è³‡æ–™**

```
ã€LINE Botã€‘
ç”¨æˆ¶ï¼šã€Œç¶²ç«™ã€
    â†“
Botï¼šå›å‚³ LIFF é€£çµæŒ‰éˆ•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š SmartCapital         â”‚
â”‚                         â”‚
â”‚ é»æ“Šä¸‹æ–¹æŒ‰éˆ•æŸ¥çœ‹å®Œæ•´è³‡æ–™ â”‚
â”‚                         â”‚
â”‚ [ğŸŒ é–‹å•Ÿç¶²ç«™]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç”¨æˆ¶é»æ“Š
    â†“
è‡ªå‹•ç™»å…¥ç¶²é ï¼ˆLIFFï¼‰
    â†“
é¡¯ç¤ºå€‹äººåŒ– Dashboard
```

---

## ğŸŒ ç¶²é ç«¯è¨­è¨ˆ

### é é¢çµæ§‹ï¼ˆå„ªåŒ–å¾Œï¼‰

```
ä¸»é  (Dashboard)           â† åˆä½µã€Œæ¦‚è¦½ã€å’Œã€ŒæŠ•è³‡ã€
â”œâ”€ è³‡ç”¢ç¸½è¦½ï¼ˆå¯æŠ˜ç–Šï¼‰
â”‚  â”œâ”€ æ·¨è³‡ç”¢ï¼šNT$1,234,567
â”‚  â”œâ”€ ä»Šæ—¥æç›Šï¼š+NT$12,345 (+1.2%)
â”‚  â””â”€ è³‡ç”¢é…ç½®åœ“é¤…åœ–
â”‚
â”œâ”€ å¿«æ·æ“ä½œ
â”‚  [ğŸ“ è¨˜ä¸€ç­†] [ğŸ’° è²·è‚¡ç¥¨] [ğŸ§® ç­–ç•¥]
â”‚
â”œâ”€ è³‡ç”¢é…ç½® + ä»Šæ—¥å‹•æ…‹
â”‚  â”œâ”€ å·¦ï¼šåœ“é¤…åœ–ï¼ˆå°è‚¡ 60% / ç¾è‚¡ 40%ï¼‰
â”‚  â””â”€ å³ï¼šä»Šæ—¥æ³¢å‹•å‰ 3 å
â”‚
â””â”€ æˆ‘çš„æŒè‚¡ï¼ˆä¸»è¦å…§å®¹ï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ‡¹ğŸ‡¼ å°ç©é›» (2330.TW)          â”‚
   â”‚ NT$650  +0.77%                â”‚
   â”‚ æŒæœ‰ 100 è‚¡ | å¸‚å€¼ NT$65,000  â”‚
   â”‚ [è²·å…¥] [è³£å‡º]                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¨˜å¸³ (Ledger)
â”œâ”€ å¿«é€Ÿè¼¸å…¥æ¡†ï¼ˆStickyï¼‰
â”‚  â””â”€ è¼¸å…¥é‡‘é¡æŒ‰ Enter â†’ ç«‹å³è¨˜å¸³
â”œâ”€ æ—¥æœŸå°èˆªï¼ˆæœˆ/å¹´ï¼‰
â”œâ”€ çµ±è¨ˆå¡ç‰‡ï¼ˆæ”¶å…¥/æ”¯å‡º/çµé¤˜ï¼‰
â”œâ”€ è¶¨å‹¢åœ–è¡¨ï¼ˆç²¾ç°¡ç‰ˆï¼‰
â””â”€ äº¤æ˜“åˆ—è¡¨ï¼ˆæŒ‰æ—¥æœŸåˆ†çµ„ï¼‰

å·¥å…· (Tools)
â”œâ”€ ç­–ç•¥è¨ˆç®—å™¨
â”‚  â”œâ”€ å‡±åˆ©å…¬å¼
â”‚  â””â”€ é¦¬ä¸æ ¼çˆ¾
â”œâ”€ è³‡ç”¢å ±å‘Š
â””â”€ è¨­å®š
```

### ä¸»é è¨­è¨ˆç´°ç¯€

#### **è³‡ç”¢é…ç½®ï¼ˆåœ“é¤…åœ–ï¼‰**

**é¡¯ç¤ºå…§å®¹**ï¼š
```
ğŸ‡¹ğŸ‡¼ å°è‚¡        60%  (NT$600,000)
ğŸ‡ºğŸ‡¸ ç¾è‚¡        30%  (NT$300,000)
â‚¿ åŠ å¯†è²¨å¹£       10%  (NT$100,000)
```

**è‡ªå‹•åˆ†é¡è¦å‰‡**ï¼š
- å°è‚¡ï¼š`.TW` / `.TWO` çµå°¾
- ç¾è‚¡ï¼šä¸€èˆ¬å­—æ¯ä»£ç¢¼
- åŠ å¯†è²¨å¹£ï¼šBTC / ETH / æˆ– type='Crypto'

**ç‚ºä»€éº¼é‡è¦**ï¼š
- ä¸€çœ¼çœ‹å‡ºæŠ•è³‡åˆ†æ•£åº¦
- ç™¼ç¾é›†ä¸­é¢¨éšªï¼ˆä¾‹å¦‚å°è‚¡ 90%ï¼‰
- è¼”åŠ©å†å¹³è¡¡æ±ºç­–

#### **ä»Šæ—¥å‹•æ…‹ï¼ˆTop Moversï¼‰**

**é¡¯ç¤ºå…§å®¹**ï¼š
```
ä»Šæ—¥æ³¢å‹•æœ€å¤§çš„å‰ 3 æ”¯è‚¡ç¥¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TSLA                    â”‚
â”‚ Tesla Inc.              â”‚
â”‚ $250.00    +8.5% ğŸŸ¢    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2330.TW                 â”‚
â”‚ å°ç©é›»                  â”‚
â”‚ NT$650     +2.1% ğŸŸ¢    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AAPL                    â”‚
â”‚ Apple Inc.              â”‚
â”‚ $180.00    -3.2% ğŸ”´    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ’åºé‚è¼¯**ï¼š
- æŒ‰**çµ•å°å€¼**æ’åºï¼ˆæ¼² 8% å’Œè·Œ 8% éƒ½ç®—æ³¢å‹•å¤§ï¼‰
- åªå–å‰ 3 å

**ç‚ºä»€éº¼é‡è¦**ï¼š
- å¿«é€ŸçŸ¥é“ä»Šå¤©éœ€è¦é—œæ³¨çš„è‚¡ç¥¨
- ä¸ç”¨ä¸€å€‹å€‹é»é–‹æŸ¥çœ‹
- å¹«åŠ©æ±ºç­–ï¼ˆåœåˆ©/åœæ/åŠ ç¢¼ï¼‰

#### **æŒè‚¡å¡ç‰‡**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‡¹ğŸ‡¼ å°ç©é›» (2330.TW)    [å°è‚¡] æ¨™ç±¤   â”‚
â”‚ NT$650.00              +5.00 (+0.77%)â”‚
â”‚                                       â”‚
â”‚ æŒæœ‰ 100 è‚¡ | æˆæœ¬ NT$620 | å¸‚å€¼ NT$65Kâ”‚
â”‚ æç›Š +NT$3,000 (+4.84%) ğŸŸ¢           â”‚
â”‚                                       â”‚
â”‚ [è²·å…¥] [è³£å‡º] â† Hover æ™‚é¡¯ç¤º           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é»æ“Šå¡ç‰‡**ï¼š
```
é–‹å•Ÿã€Œå€‹è‚¡è©³æƒ… Modalã€
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Headerï¼ˆæ¼¸å±¤èƒŒæ™¯ï¼‰       â”‚
â”‚ å°ç©é›» 2330.TW          â”‚
â”‚ NT$650.00  +0.77%       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŒè‚¡è³‡è¨Šç¶²æ ¼             â”‚
â”‚ [æ•¸é‡] [æˆæœ¬] [å¸‚å€¼] [æç›Š]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åƒ¹æ ¼èµ°å‹¢åœ–ï¼ˆLineChartï¼‰   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è²·å…¥] [è³£å‡º] [æ›´å¤š]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¨˜å¸³é è¨­è¨ˆç´°ç¯€

#### **å¿«é€Ÿè¼¸å…¥æ¡†ï¼ˆé ‚éƒ¨ Stickyï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¿«é€Ÿè¨˜å¸³ï¼šè¼¸å…¥é‡‘é¡æŒ‰ Enter â     â”‚
â”‚ [ _________________ ] ğŸ’µ        â”‚
â”‚                                 â”‚
â”‚ å¸¸ç”¨ï¼š[é£²é£Ÿ] [äº¤é€š] [è³¼ç‰©]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æµç¨‹**ï¼š
1. è¼¸å…¥é‡‘é¡ â†’ æŒ‰ Enter
2. è‡ªå‹•ä½¿ç”¨ã€Œæœ€è¿‘æœ€å¸¸ç”¨çš„åˆ†é¡ã€
3. ç«‹å³è¨˜éŒ„ï¼Œç„¡éœ€é¸æ“‡

**å„ªé»**ï¼š
- å¾ 8 æ­¥é©Ÿ â†’ 1 æ­¥é©Ÿ
- é©åˆé‡è¤‡æ€§æ”¯å‡ºï¼ˆæ¯å¤©åˆé¤ï¼‰
- éŒ¯èª¤æ™‚é»æ“Šã€Œç·¨è¼¯ã€ä¿®æ”¹

#### **çµ±è¨ˆå¡ç‰‡ï¼ˆç²¾ç°¡ç‰ˆï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ”¶å…¥]    [æ”¯å‡º]    [çµé¤˜]        â”‚
â”‚ +45,000   -32,000   +13,000      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¶¨å‹¢åœ–ï¼ˆé«˜åº¦ 120pxï¼‰**ï¼š
```
æ”¶æ”¯è¶¨å‹¢ï¼ˆæœ¬æœˆï¼‰
   â–²
45Kâ”‚     â•±â•²
   â”‚    â•±  â•²        æ”¶å…¥
30Kâ”‚   â•±    â•²      
   â”‚  â•±      â•²â•±â•²   æ”¯å‡º
15Kâ”‚ â•±          â•²
   â”‚â•±            â•²
 0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
   1/1   1/15   1/31
```

### è²·è‚¡ç¥¨æµç¨‹ï¼ˆæ–°å¢ Modalï¼‰

#### **å…¥å£ 1ï¼šå¿«æ·æŒ‰éˆ•**

```
Dashboard é»æ“Šã€Œè²·è‚¡ç¥¨ã€
    â†“
å½ˆå‡ºã€Œè²·å…¥è‚¡ç¥¨ Modalã€
```

#### **å…¥å£ 2ï¼šæŒè‚¡å¡ç‰‡**

```
æŒè‚¡å¡ç‰‡ Hover â†’ é¡¯ç¤ºã€Œè²·å…¥ã€æŒ‰éˆ•
    â†“
é»æ“Šã€Œè²·å…¥ã€â†’ é–‹å•Ÿ Modalï¼ˆå¸¶å…¥ç¾æœ‰è‚¡ç¥¨è³‡è¨Šï¼‰
```

#### **å…¥å£ 3ï¼šå€‹è‚¡è©³æƒ…**

```
é»æ“ŠæŒè‚¡å¡ç‰‡ â†’ è©³æƒ… Modal
    â†“
é»æ“Šã€Œè²·å…¥ã€æŒ‰éˆ•
```

#### **BuyStockModal è¨­è¨ˆï¼ˆæ”¯æ´è¤‡å§”è¨—ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Headerï¼ˆæ¼¸å±¤ï¼‰                   â”‚
â”‚ è²·å…¥è‚¡ç¥¨                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœå°‹è‚¡ç¥¨                         â”‚
â”‚ [ AAPL_____________ ] [æŸ¥è©¢]     â”‚
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Apple Inc. (AAPL)         â”‚  â”‚
â”‚ â”‚ $152.00    +1.33% ğŸŸ¢     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚ ğŸ¦ æ‰£æ¬¾å¸³æˆ¶ (Payment Source)     â”‚
â”‚ [ åœ‹æ³°è­‰åˆ¸ (TWD) â–¼ ]            â”‚
â”‚ ğŸ’° é¤˜é¡: NT$300,000 (è³¼è²·åŠ›)    â”‚
â”‚                                 â”‚
â”‚ è²·å…¥æ•¸é‡                         â”‚
â”‚ [ 10______________ ] è‚¡          â”‚
â”‚                                 â”‚
â”‚ è²·å…¥åƒ¹æ ¼                         â”‚
â”‚ [ 150.00__________ ] â† é å¡«å¸‚åƒ¹  â”‚
â”‚                                 â”‚
â”‚ âš ï¸ è¤‡å§”è¨—æ›åŒ¯æé†’                â”‚
â”‚ é ä¼°æ‰£æ¬¾: US$1,500 â‰ˆ NT$49,125  â”‚
â”‚ (åŒ¯ç‡ 1 USD = 32.75 TWD)        â”‚
â”‚ å¯¦éš›æˆäº¤åŒ¯ç‡ä»¥åˆ¸å•†ç‚ºæº–           â”‚
â”‚                                 â”‚
â”‚ è²·å…¥æ—¥æœŸ                         â”‚
â”‚ [ 2024-11-24______ ]            â”‚
â”‚                                 â”‚
â”‚ ç¸½æˆæœ¬ï¼šNT$49,125 â† å³æ™‚è¨ˆç®—    â”‚
â”‚                                 â”‚
â”‚ [å–æ¶ˆ] [ç¢ºèªè²·å…¥]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ™ºèƒ½å¸³æˆ¶é¸æ“‡é‚è¼¯**ï¼š

```typescript
// å‰ç«¯é‚è¼¯ (é©é…ä¸‰ç¨®ä½¿ç”¨è€…é¡å‹)
const BuyStockModal = ({ stock }) => {
  const { enableUSStock, enableCrypto } = useUserPreferences();
  const stockCurrency = stock.currency; // 'TWD' | 'USD' | 'USDT'
  
  // éæ¿¾å¯ç”¨å¸³æˆ¶
  const availableAccounts = accounts.filter(acc => {
    // å°è‚¡ â†’ åªå…è¨± TWD å¸³æˆ¶
    if (stockCurrency === 'TWD') {
      return acc.currency === 'TWD' && acc.type === 'BROKERAGE';
    }
    
    // ç¾è‚¡ â†’ å…è¨± USD æˆ– TWD (è¤‡å§”è¨—)
    if (stockCurrency === 'USD') {
      return (acc.currency === 'USD' || acc.currency === 'TWD') 
             && acc.type === 'BROKERAGE';
    }
    
    // åŠ å¯†è²¨å¹£ â†’ åªå…è¨± Exchange
    if (stockCurrency === 'USDT') {
      return acc.type === 'EXCHANGE';
    }
  });
  
  // é è¨­é¸æ“‡é‚è¼¯ï¼ˆè¤‡å§”è¨—å„ªå…ˆï¼‰
  const defaultAccount = 
    // 1. å„ªå…ˆåŒå¹£åˆ¥
    availableAccounts.find(a => a.currency === stockCurrency) ||
    // 2. å†æ‰¾ isDefault
    availableAccounts.find(a => a.isDefault) ||
    // 3. æœ€å¾Œå–ç¬¬ä¸€å€‹
    availableAccounts[0];
  
  const [selectedAccount, setSelectedAccount] = useState(defaultAccount);
  const needsExchange = selectedAccount?.currency !== stockCurrency;
  
  // è¨ˆç®—ç¸½æˆæœ¬ï¼ˆè€ƒæ…®åŒ¯ç‡ï¼‰
  const totalCost = useMemo(() => {
    if (!quantity || !price) return 0;
    
    const baseCost = quantity * price;
    
    if (needsExchange) {
      // è¤‡å§”è¨—æ›åŒ¯
      const rate = exchangeRates[`${stockCurrency}${selectedAccount.currency}`];
      return baseCost * rate;
    }
    
    return baseCost;
  }, [quantity, price, needsExchange]);
  
  return (
    <Modal>
      {/* ... è‚¡ç¥¨æœå°‹èˆ‡å ±åƒ¹ ... */}
      
      <AccountSelector
        accounts={availableAccounts}
        selected={selectedAccount}
        onChange={setSelectedAccount}
      />
      
      {needsExchange && (
        <ExchangeWarning 
          from={stockCurrency}
          to={selectedAccount.currency}
          amount={quantity * price}
          rate={exchangeRates[`${stockCurrency}${selectedAccount.currency}`]}
        />
      )}
      
      {/* ... æ•¸é‡/åƒ¹æ ¼è¼¸å…¥ ... */}
    </Modal>
  );
};
```

**è³‡æ–™æµ**ï¼š
```
1. è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ â†’ æŸ¥è©¢å ±åƒ¹
   â†“
2. é¡¯ç¤ºå³æ™‚åƒ¹æ ¼ + æ¼²è·Œ
   â†“
3. è¼¸å…¥æ•¸é‡/åƒ¹æ ¼ â†’ å³æ™‚è¨ˆç®—ç¸½æˆæœ¬
   â†“
4. ç¢ºèªè²·å…¥
   â†“
5. æ¨‚è§€æ›´æ–° UIï¼ˆç«‹å³é¡¯ç¤ºï¼‰
   â†“
6. èª¿ç”¨ API ä¿å­˜
   â†“
7. æˆåŠŸï¼šæ›´æ–°çœŸå¯¦ ID
   å¤±æ•—ï¼šå›é€€ä¸¦é¡¯ç¤ºéŒ¯èª¤
```

---

## ğŸ“± LINE Bot è¨­è¨ˆ

### è¨Šæ¯è§£æé‚è¼¯

```typescript
parseMessage(text: string) {
  // 1. è¨˜å¸³æ¨¡å¼
  if (/^[+-]?\d+$/.test(text)) {
    return { type: 'EXPENSE', amount: parseInt(text) };
  }
  
  // 2. è‚¡ç¥¨æ¨¡å¼ï¼ˆå°è‚¡ï¼‰
  if (/^\d{4}$/.test(text)) {
    return { type: 'STOCK_QUERY', symbol: text + '.TW' };
  }
  
  // 3. è‚¡ç¥¨æ¨¡å¼ï¼ˆç¾è‚¡/åŠ å¯†è²¨å¹£ï¼‰
  if (/^[A-Z]{2,5}$/.test(text)) {
    return { type: 'STOCK_QUERY', symbol: text };
  }
  
  // 4. ç­–ç•¥è¨ˆç®—
  if (/å‡±åˆ©|kelly/i.test(text)) {
    return { type: 'KELLY_CALCULATOR' };
  }
  
  // 5. æŸ¥çœ‹ç¶²ç«™
  if (/ç¶²ç«™|web|æŸ¥çœ‹/i.test(text)) {
    return { type: 'WEBSITE_LINK' };
  }
  
  // 6. å¹«åŠ©
  return { type: 'HELP' };
}
```

### Flex Message è¨­è¨ˆ

#### **è‚¡ç¥¨è¡Œæƒ…å¡ç‰‡**

```json
{
  "type": "bubble",
  "hero": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "text",
        "text": "ğŸ‡¹ğŸ‡¼ å°ç©é›»",
        "weight": "bold",
        "size": "xl"
      },
      {
        "type": "text",
        "text": "2330.TW",
        "size": "sm",
        "color": "#999999"
      }
    ]
  },
  "body": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "text",
        "text": "NT$650.00",
        "weight": "bold",
        "size": "xxl",
        "color": "#1DB446"
      },
      {
        "type": "text",
        "text": "+5.00 (+0.77%)",
        "color": "#1DB446"
      }
    ]
  },
  "footer": {
    "type": "box",
    "layout": "horizontal",
    "contents": [
      {
        "type": "button",
        "action": {
          "type": "message",
          "label": "è²·å…¥",
          "text": "è²·å…¥ 2330"
        },
        "style": "primary"
      },
      {
        "type": "button",
        "action": {
          "type": "message",
          "label": "è³£å‡º",
          "text": "è³£å‡º 2330"
        }
      }
    ]
  }
}
```

#### **ä½¿ç”¨èªªæ˜å¡ç‰‡ï¼ˆ4 å¼µè¼ªæ’­ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¡ç‰‡ 1ï¼šè¨˜å¸³åŠŸèƒ½         â”‚
â”‚ ğŸ“ å¿«é€Ÿè¨˜å¸³             â”‚
â”‚ å‚³é€é‡‘é¡å³å¯è¨˜å¸³         â”‚
â”‚ ä¾‹å¦‚ï¼š-120              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¡ç‰‡ 2ï¼šè‚¡ç¥¨æŸ¥è©¢         â”‚
â”‚ ğŸ“ˆ å³æ™‚å ±åƒ¹             â”‚
â”‚ å‚³é€è‚¡ç¥¨ä»£ç¢¼             â”‚
â”‚ ä¾‹å¦‚ï¼š2330 æˆ– AAPL       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¡ç‰‡ 3ï¼šç­–ç•¥è¨ˆç®—         â”‚
â”‚ ğŸ§® æ™ºèƒ½å»ºè­°             â”‚
â”‚ å‡±åˆ©å…¬å¼æœ€ä½³å€‰ä½         â”‚
â”‚ é¦¬ä¸æ ¼çˆ¾åŠ ç¢¼é»ä½         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¡ç‰‡ 4ï¼šç¶²ç«™æŸ¥çœ‹         â”‚
â”‚ ğŸŒ å®Œæ•´è³‡æ–™             â”‚
â”‚ é»æ“ŠæŒ‰éˆ•é–‹å•Ÿç¶²ç«™         â”‚
â”‚ æŸ¥çœ‹åœ–è¡¨å’Œè©³ç´°åˆ†æ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ™ºèƒ½åˆ†é¡é æ¸¬

#### **Phase 1ï¼šè¦å‰‡åŸºç¤**

```typescript
predictCategory(amount: number, time: string, history: Transaction[]) {
  // 1. æ™‚é–“è¦å‰‡
  const hour = parseInt(time.split(':')[0]);
  if (hour >= 11 && hour <= 14 && amount < 500) {
    return 'é£²é£Ÿ'; // åˆé¤æ™‚é–“ï¼Œå°é¡ â†’ é£²é£Ÿ
  }
  
  // 2. é‡‘é¡è¦å‰‡
  if (amount >= 5000) {
    return 'å±…ä½'; // å¤§é¡ â†’ å¯èƒ½æ˜¯æˆ¿ç§Ÿ
  }
  
  // 3. æ­·å²è¦å‰‡
  const recentExpenses = history.slice(0, 10);
  const categoryCount = new Map();
  recentExpenses.forEach(t => {
    if (Math.abs(t.amount - amount) < 50) {
      categoryCount.set(
        t.category, 
        (categoryCount.get(t.category) || 0) + 1
      );
    }
  });
  
  // è¿”å›æœ€å¸¸å‡ºç¾çš„åˆ†é¡
  return Array.from(categoryCount.entries())
    .sort((a, b) => b[1] - a[1])[0]?.[0] || 'å…¶ä»–';
}
```

#### **Phase 2ï¼šæ©Ÿå™¨å­¸ç¿’ï¼ˆæœªä¾†ï¼‰**

```python
# ä½¿ç”¨ TensorFlow.js æˆ–å¾Œç«¯ Python æ¨¡å‹
features = [
  amount,           # é‡‘é¡
  hour,             # æ™‚é–“ï¼ˆå°æ™‚ï¼‰
  day_of_week,      # æ˜ŸæœŸå¹¾
  is_weekend,       # æ˜¯å¦é€±æœ«
  avg_similar_txn   # ç›¸ä¼¼é‡‘é¡çš„å¹³å‡åˆ†é¡
]

model.predict(features) â†’ category
```

---

## ğŸ”— åŠŸèƒ½æ•´åˆ

### Web â†” LINE Bot åŒæ­¥

#### **è³‡æ–™æµå‘**

```
LINE Bot è¨˜å¸³
    â†“
å¾Œç«¯ API (POST /api/transactions)
    â†“
è³‡æ–™åº« (Transactions è¡¨)
    â†“
Web æŸ¥è©¢ (GET /api/transactions/:userId)
    â†“
å³æ™‚é¡¯ç¤ºåœ¨ Ledger é é¢
```

#### **LIFF æ•´åˆç™»å…¥**

```
ç”¨æˆ¶åœ¨ LINE Bot é»æ“Šã€Œç¶²ç«™ã€
    â†“
Bot ç™¼é€ LIFF é€£çµ
    â†“
ç”¨æˆ¶é»æ“Š â†’ é–‹å•Ÿ LIFF App
    â†“
LIFF SDK è‡ªå‹•å–å¾— LINE Profile
    â†“
å‰ç«¯å–å¾— userId å’Œ displayName
    â†“
å‘¼å« API è¼‰å…¥å€‹äººè³‡æ–™
    â†“
é¡¯ç¤ºå€‹äººåŒ– Dashboard
```

**LIFF è¨­å®š**ï¼š
- Size: Fullï¼ˆå…¨è¢å¹•ï¼‰
- Scopes: profile, openid
- Endpoint URL: https://your-domain.com

**å‰ç«¯ç¨‹å¼ç¢¼**ï¼š
```typescript
// hooks/useLiff.ts
const { isLoggedIn, userId, displayName } = useLiff();

// ä½¿ç”¨ userId è¼‰å…¥è³‡æ–™
const { portfolio, transactions } = useUserData(userId);
```

### è²·è‚¡ç¥¨æ•´åˆ

#### **Web â†’ è³‡æ–™åº« â†’ LINE Bot é€šçŸ¥**

```
Web è²·å…¥è‚¡ç¥¨
    â†“
POST /api/transactions/stock/buy
    â†“
è³‡æ–™åº«æ–°å¢ StockTransaction
    â†“
æ›´æ–° Assets è¡¨ï¼ˆæŒè‚¡ï¼‰
    â†“
LINE Bot æ¨æ’­é€šçŸ¥ï¼š
ã€Œâœ… è²·å…¥æˆåŠŸ
 AAPL x10 @ $150.00
 ç¸½æˆæœ¬ï¼š$1,500ã€
```

#### **LINE Bot â†’ è³‡æ–™åº« â†’ Web åŒæ­¥**

```
LINE Botã€Œè²·å…¥ 2330ã€
    â†“
Bot ç¢ºèªå¾Œèª¿ç”¨ API
    â†“
POST /api/transactions/stock/buy
    â†“
Web å³æ™‚æ›´æ–°æŒè‚¡å¡ç‰‡
```

---

## ğŸ— æŠ€è¡“æ¶æ§‹

### å‰ç«¯ï¼ˆWeb Appï¼‰

**æŠ€è¡“å †ç–Š**ï¼š
- React 19.2.0 + TypeScript
- Vite 6.4.1ï¼ˆå»ºç½®å·¥å…·ï¼‰
- React Routerï¼ˆè·¯ç”±ï¼‰
- Rechartsï¼ˆåœ–è¡¨ï¼‰
- Tailwind CSSï¼ˆMorandi é…è‰²ï¼‰

**éƒ¨ç½²**ï¼š
- Vercelï¼ˆè‡ªå‹•éƒ¨ç½²ï¼‰
- CDN åŠ é€Ÿ

**API æ•´åˆ**ï¼š
```typescript
// services/api.ts
export const getAssets = (userId: string) => 
  fetch(`/api/assets/${userId}`).then(r => r.json());

export const createTransaction = (data) =>
  fetch('/api/transactions', {
    method: 'POST',
    body: JSON.stringify(data)
  });
```

### å¾Œç«¯ï¼ˆLINE Bot + API Serverï¼‰

**æŠ€è¡“å †ç–Š**ï¼š
- Node.js 18+ + TypeScript
- Express.jsï¼ˆWeb æ¡†æ¶ï¼‰
- Prisma ORMï¼ˆè³‡æ–™åº«ï¼‰
- LINE Bot SDK 2.27.3
- Yahoo Finance APIï¼ˆè‚¡åƒ¹ï¼‰

**æ¶æ§‹**ï¼š
```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              â† ä¸»ç¨‹å¼
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ webhookController.ts   â† LINE Webhook
â”‚   â”‚   â””â”€â”€ apiController.ts       â† REST API
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ stockService.ts        â† è‚¡åƒ¹æŸ¥è©¢
â”‚   â”‚   â”œâ”€â”€ strategyService.ts     â† ç­–ç•¥è¨ˆç®—
â”‚   â”‚   â””â”€â”€ databaseService.ts     â† è³‡æ–™åº«æ“ä½œ
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ messageParser.ts       â† è¨Šæ¯è§£æ
â”‚       â””â”€â”€ flexMessages.ts        â† Flex Message
â””â”€â”€ prisma/
    â””â”€â”€ schema.prisma          â† è³‡æ–™åº« Schema
```

**éƒ¨ç½²**ï¼š
- Renderï¼ˆå¾Œç«¯ + è³‡æ–™åº«ï¼‰
- PostgreSQLï¼ˆç”Ÿç”¢ï¼‰
- ç’°å¢ƒè®Šæ•¸ç®¡ç†

### è³‡æ–™åº« Schema

```prisma
model User {
  id          String   @id @default(cuid())
  lineUserId  String   @unique
  displayName String?
  bankroll    Float    @default(0)
  createdAt   DateTime @default(now())
  
  transactions Transaction[]
  assets       Asset[]
  settings     UserSettings?
}

model Transaction {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  date      DateTime
  type      String   // 'income' | 'expense'
  amount    Float
  category  String
  note      String?
  
  createdAt DateTime @default(now())
}

model Asset {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  symbol    String   // 'AAPL' | '2330.TW'
  type      String   // 'Stock' | 'Crypto' | 'ETF'
  quantity  Float
  avgPrice  Float
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model StockTransaction {
  id        String   @id @default(cuid())
  userId    String
  
  symbol    String
  type      String   // 'buy' | 'sell'
  quantity  Float
  price     Float
  date      DateTime
  
  createdAt DateTime @default(now())
}
```

### API ç«¯é»

#### **å…¬é–‹ API**

```
POST /webhook
- LINE Platform Webhook
- é©—è­‰ç°½å
- è·¯ç”±è¨Šæ¯

GET /health
- å¥åº·æª¢æŸ¥
```

#### **ä½¿ç”¨è€… API**

```
GET /api/user/:userId
- å–å¾—ä½¿ç”¨è€…è³‡æ–™

POST /api/user/:userId/settings
- æ›´æ–°ç­–ç•¥åƒæ•¸
```

#### **äº¤æ˜“ API**

```
GET /api/transactions/:userId
- å–å¾—äº¤æ˜“è¨˜éŒ„

POST /api/transactions
- æ–°å¢äº¤æ˜“è¨˜éŒ„

DELETE /api/transactions/:id
- åˆªé™¤äº¤æ˜“è¨˜éŒ„
```

#### **è³‡ç”¢ API**

```
GET /api/assets/:userId
- å–å¾—æŒè‚¡åˆ—è¡¨

POST /api/transactions/stock/buy
- è²·å…¥è‚¡ç¥¨

POST /api/transactions/stock/sell
- è³£å‡ºè‚¡ç¥¨
```

#### **è‚¡ç¥¨ API**

```
GET /api/stocks/quote/:symbol
- æŸ¥è©¢å³æ™‚å ±åƒ¹
- æ•´åˆ Yahoo Finance
- å°è‚¡è‡ªå‹•åŠ  .TW
```

---

## ğŸ—º å¯¦ä½œè·¯ç·šåœ–

### Phase 1ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆå·²å®Œæˆ âœ…ï¼‰

- [x] LINE Bot åŸºæœ¬è¨Šæ¯è™•ç†
- [x] è‚¡ç¥¨æŸ¥è©¢ï¼ˆYahoo Financeï¼‰
- [x] å‡±åˆ©/é¦¬ä¸æ ¼çˆ¾è¨ˆç®—
- [x] Flex Message è¡Œæƒ…å¡ç‰‡
- [x] Web Dashboard åŸºæœ¬ç‰ˆ
- [x] Ledger è¨˜å¸³åŠŸèƒ½
- [x] LIFF ç™»å…¥æ•´åˆ

### Phase 2ï¼šå¸³æˆ¶ç³»çµ±èˆ‡è¤‡å§”è¨—æ”¯æ´ï¼ˆå„ªå…ˆ ğŸ”¥ï¼‰

**P0 - å¿…é ˆå®Œæˆï¼ˆè³‡ç”¢é–‰ç’°ï¼‰**
- [ ] Account æ¨¡å‹ Migration
- [ ] Transfer æ¨¡å‹ Migration
- [ ] User æŠ•è³‡ç¯„åœè¨­å®šæ¬„ä½
- [ ] Onboarding æµç¨‹ï¼ˆæŠ•è³‡ç¯„åœé¸æ“‡ï¼‰
- [ ] æ™ºèƒ½é è¨­å¸³æˆ¶é‚è¼¯
- [ ] è¤‡å§”è¨—æ”¯æ´ï¼ˆTWD è²·ç¾è‚¡ï¼‰
- [ ] Dashboard ç¾é‡‘/æŠ•è³‡éƒ¨ä½æ‹†åˆ†é¡¯ç¤º

**P1 - é‡è¦åŠŸèƒ½**
- [x] åˆä½µ Dashboard + Portfolio
- [x] å€‹è‚¡è©³æƒ… Modal
- [x] å¿«é€Ÿè¨˜å¸³è¼¸å…¥æ¡†
- [ ] BuyStockModal çµ„ä»¶ï¼ˆæ”¯æ´å¸³æˆ¶é¸æ“‡ + è¤‡å§”è¨—ï¼‰
- [ ] è²·å…¥/è³£å‡º APIï¼ˆé€£å‹•å¸³æˆ¶é¤˜é¡ï¼‰
- [ ] å¸³æˆ¶ç®¡ç†é é¢
- [ ] è³¼è²·åŠ›æª¢æŸ¥èˆ‡ä¸è¶³æç¤º

**P2 - é«”é©—å„ªåŒ–**
- [ ] ç©ºç‹€æ…‹å¼•å°
- [ ] æ™ºèƒ½åˆ†é¡é æ¸¬ï¼ˆè¦å‰‡ç‰ˆï¼‰
- [ ] è½‰å¸³åŠŸèƒ½ï¼ˆå«è·¨å¹£åˆ¥æ›åŒ¯ï¼‰

### Phase 3ï¼šå¤šå¹£åˆ¥èˆ‡å®šæœŸæŠ•è³‡ï¼ˆé€²è¡Œä¸­ ğŸ”„ï¼‰

**P0 - å¤šå¹£åˆ¥æ”¯æ´**
- [ ] Transaction.originalCurrency æ¬„ä½
- [ ] Asset å¤šå¹£åˆ¥æ¬„ä½
- [ ] ExchangeRateService æ•´åˆ
- [ ] åŒ¯ç‡å¿«å–æ©Ÿåˆ¶ï¼ˆ1å°æ™‚ï¼‰
- [ ] å¤šå¹£åˆ¥é¡¯ç¤ºåˆ‡æ›

**P1 - å®šæœŸæŠ•è³‡**
- [ ] RecurringTransaction æ¨¡å‹
- [ ] LINE Bot å®šæœŸæé†’
- [ ] ä¸€éµç¢ºèªé‡è¤‡äº¤æ˜“
- [ ] å®šæœŸæŠ•è³‡ç®¡ç†é é¢

### Phase 4ï¼šé€²éšåŠŸèƒ½ï¼ˆè¦åŠƒä¸­ ğŸ“‹ï¼‰

- [ ] å…¨å±€æœå°‹
- [ ] è³‡ç”¢å ±å‘Šï¼ˆæœˆå ±/å¹´å ±ï¼‰
- [ ] åƒ¹æ ¼é è­¦æ¨æ’­
- [ ] äº¤æ˜“æ­·å²é é¢
- [ ] ç¾¤çµ„èŠå¤©æ”¯æ´
- [ ] åŒ¯å‡ºè³‡æ–™ï¼ˆCSV/PDFï¼‰

### Phase 5ï¼šæ™ºèƒ½å‡ç´šï¼ˆæœªä¾† ğŸš€ï¼‰

- [ ] æ©Ÿå™¨å­¸ç¿’åˆ†é¡é æ¸¬
- [ ] èªéŸ³è¼¸å…¥è¨˜å¸³
- [ ] åœ–è¡¨è‡ªå‹•ç”Ÿæˆ
- [ ] AI æŠ•è³‡å»ºè­°
- [ ] ç¤¾ç¾¤åŠŸèƒ½ï¼ˆåˆ†äº«ç­–ç•¥ï¼‰
- [ ] è·¨å¹³å°åŒæ­¥ï¼ˆiOS/Androidï¼‰

---

## ğŸ“Š è¨­è¨ˆæ±ºç­–ç¸½çµ

### å·²ç¢ºèªçš„è¨­è¨ˆæ–¹å‘

#### **1. è³‡æ–™çµæ§‹**
âœ… **å…©è€…éƒ½è¨˜éŒ„**
- StockTransaction è¡¨ï¼šè¨˜éŒ„æ¯ç­†è²·è³£
- Asset è¡¨ï¼šèšåˆç•¶å‰æŒè‚¡ç‹€æ…‹

#### **2. å¹³å‡æˆæœ¬è¨ˆç®—**
âœ… **åŠ æ¬Šå¹³å‡æˆæœ¬æ³•**
- å¤šæ¬¡è²·å…¥ï¼š(qty1Ã—price1 + qty2Ã—price2) / total_qty
- è³£å‡ºä¸å½±éŸ¿å‰©é¤˜æŒè‚¡æˆæœ¬

#### **3. æ‰‹çºŒè²»è™•ç†**
âœ… **Phase 1 ç°¡åŒ–ç‰ˆ**
- åªè¨˜éŒ„ç¸½æˆæœ¬
- Phase 2 å†åŠ æ‰‹çºŒè²»æ¬„ä½

#### **4. åƒ¹æ ¼ä¾†æº**
âœ… **æ··åˆæ¨¡å¼**
- è‡ªå‹•æŸ¥è©¢å¸‚åƒ¹ï¼ˆåƒè€ƒï¼‰
- ä½¿ç”¨è€…å¯ä¿®æ”¹å¯¦éš›æˆäº¤åƒ¹

#### **5. LINE Bot æ™ºèƒ½åˆ†é¡**
âœ… **è‡ªå‹•é æ¸¬ + æ‰‹å‹•ä¿®æ­£**
- Bot è‡ªå‹•è¨˜éŒ„åˆ°é æ¸¬åˆ†é¡
- éŒ¯èª¤æ™‚å›è¦†ã€Œæ”¹ç‚º [åˆ†é¡]ã€

#### **6. é é¢çµæ§‹**
âœ… **3 å€‹ä¸»è¦åŠŸèƒ½**
- ä¸»é ï¼ˆæ¦‚è¦½ + æŠ•è³‡ï¼‰
- è¨˜å¸³ï¼ˆå¿«é€Ÿè¼¸å…¥ï¼‰
- å·¥å…·ï¼ˆç­–ç•¥ + è¨­å®šï¼‰

#### **7. æ¼¸é€²å¼æ­éœ²ï¼ˆProgressive Disclosureï¼‰**
âœ… **æ ¹æ“šæŠ•è³‡ç¯„åœé©é…ä»‹é¢**
- Type Aï¼ˆç´”å°è‚¡ï¼‰ï¼šéš±è—æ‰€æœ‰ USD/å¹£åˆ¥é¸é …ï¼Œæ¥µç°¡ä»‹é¢
- Type Bï¼ˆè¤‡å§”è¨—ï¼‰ï¼šæ”¯æ´ TWD è²·ç¾è‚¡ï¼Œè‡ªå‹•è¨ˆç®—åŒ¯ç‡
- Type Cï¼ˆé›™æ£²ï¼‰ï¼šå®Œæ•´åŠŸèƒ½ï¼Œå¤šå¹£åˆ¥å¸³æˆ¶ç®¡ç†

#### **8. è¤‡å§”è¨—æ”¯æ´**
âœ… **å°ç£ç‰¹æœ‰çš„äº¤æ˜“ç¿’æ…£**
- å…è¨±ç”¨ TWD å¸³æˆ¶è³¼è²·ç¾è‚¡
- è‡ªå‹•é¡¯ç¤ºé ä¼°æ›åŒ¯é‡‘é¡
- æé†’ã€Œå¯¦éš›åŒ¯ç‡ä»¥åˆ¸å•†ç‚ºæº–ã€
- ä¸å¼·è¿«ç”¨æˆ¶ç¶­è­·ç¾é‡‘å¸³æˆ¶

#### **9. å¸³æˆ¶ç³»çµ±**
âœ… **Account-Based æ¶æ§‹ï¼ˆè³‡ç”¢é–‰ç’°ï¼‰**
- è²·è‚¡ç¥¨ = è³‡ç”¢ç½®æ›ï¼ˆç¾é‡‘ ğŸ“‰ è‚¡ç¥¨ ğŸ“ˆï¼‰
- è½‰å¸³ä¸å½±éŸ¿ç¸½è³‡ç”¢æ·¨å€¼
- æ¯ç­†äº¤æ˜“éƒ½é—œè¯åˆ°å…·é«”å¸³æˆ¶
- è³¼è²·åŠ›å³æ™‚æª¢æŸ¥èˆ‡é¤˜é¡è¿½è¹¤

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### ä½¿ç”¨é«”é©—æŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™ | ç•¶å‰ |
|------|------|------|
| è¨˜å¸³å¹³å‡æ™‚é–“ | < 10 ç§’ | 30 ç§’ |
| æŸ¥è©¢è‚¡åƒ¹æ™‚é–“ | < 3 ç§’ | 5 ç§’ |
| æ–°ç”¨æˆ¶ä¸Šæ‰‹æ™‚é–“ | < 2 åˆ†é˜ | 5 åˆ†é˜ |
| é¦–å±è¼‰å…¥æ™‚é–“ | < 2 ç§’ | 3 ç§’ |

### åŠŸèƒ½ä½¿ç”¨ç‡

| åŠŸèƒ½ | ç›®æ¨™ä½¿ç”¨ç‡ |
|------|-----------|
| è¨˜å¸³ï¼ˆLINEï¼‰ | 60% |
| è‚¡ç¥¨æŸ¥è©¢ | 80% |
| ç­–ç•¥è¨ˆç®— | 30% |
| ç¶²ç«™æŸ¥çœ‹ | 40% |
| è²·å…¥/è³£å‡º | 20% |

### ç•™å­˜ç‡

| æ™‚é–“ | ç›®æ¨™ç•™å­˜ |
|------|---------|
| æ¬¡æ—¥ç•™å­˜ | 50% |
| 7 æ—¥ç•™å­˜ | 30% |
| 30 æ—¥ç•™å­˜ | 20% |

---

## âš ï¸ è¨­è¨ˆç›²é»èˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1ï¼šã€Œè½‰å¸³ã€vsã€Œæ”¯å‡ºã€çš„çŸ›ç›¾ ğŸ”´ Critical

#### **å•é¡Œæè¿°**

ç•¶ä½¿ç”¨è€…æŠŠ NT$50,000 å¾éŠ€è¡ŒåŒ¯åˆ°è­‰åˆ¸æˆ¶æº–å‚™è²·è‚¡ç¥¨ï¼š

```
æƒ…å¢ƒï¼šè½‰å¸³ NT$50,000 åˆ° Firstrade

âŒ æ–¹æ¡ˆ Aï¼šè¨˜ç‚ºã€Œæ”¯å‡ºã€
   â†’ Ledger é¡¯ç¤º -NT$50,000
   â†’ æ·¨è³‡ç”¢ç¬é–“æ¸›å°‘ NT$50,000
   â†’ éŒ¯èª¤ï¼éŒ¢é‚„åœ¨ï¼Œåªæ˜¯æ›åœ°æ–¹

âŒ æ–¹æ¡ˆ Bï¼šä¸è¨˜éŒ„
   â†’ ä½¿ç”¨è€…è²·è‚¡ç¥¨æ™‚æ‰¾ä¸åˆ°è³‡é‡‘ä¾†æº
   â†’ è³‡ç”¢è² å‚µè¡¨ä¸å¹³è¡¡

âœ… æ–¹æ¡ˆ Cï¼šå¼•å…¥ã€Œå¸³æˆ¶ç³»çµ±ã€
   â†’ å°æ–°éŠ€è¡Œ -NT$50,000
   â†’ Firstrade +NT$50,000
   â†’ æ·¨è³‡ç”¢ä¸è®Š
```

#### **æ ¸å¿ƒç†å¿µï¼šè³‡ç”¢é–‰ç’°ï¼ˆAsset Closureï¼‰**

```
âŒ æ²’åŠ å¸³æˆ¶ä¹‹å‰ï¼š
è²·è‚¡ç¥¨ = è³‡ç”¢æ†‘ç©ºå¢åŠ ï¼ˆåƒè®Šé­”è¡“ï¼‰
ç¸½è³‡ç”¢ = ç¾é‡‘ + è‚¡ç¥¨ï¼ˆé‚è¼¯çŸ›ç›¾ï¼‰

âœ… åŠ äº†å¸³æˆ¶ä¹‹å¾Œï¼š
è²·è‚¡ç¥¨ = è³‡ç”¢ç½®æ›ï¼ˆç¾é‡‘ ğŸ“‰ è‚¡ç¥¨ ğŸ“ˆï¼‰
ç¸½è³‡ç”¢ä¸è®Šï¼Œä½†é…ç½®æ”¹è®Šï¼ˆç¬¦åˆçœŸå¯¦ä¸–ç•Œï¼‰

é€™æ˜¯å¾ã€Œè¨˜éŒ„å·¥å…·ã€â†’ã€Œè³‡ç”¢ç®¡ç†ç³»çµ±ã€çš„é—œéµå‡ç´š
```

#### **è§£æ±ºæ–¹æ¡ˆï¼šAccount-Based æ¶æ§‹**

**æ–°å¢ Account æ¦‚å¿µ**ï¼š

```typescript
interface Account {
  id: string;
  userId: string;
  name: string;           // "å°æ–°éŠ€è¡Œ", "Firstrade", "å¹£å®‰"
  type: 'CASH' | 'BANK' | 'BROKERAGE' | 'EXCHANGE';
  currency: 'TWD' | 'USD'; // ä¸»è¦å¹£åˆ¥
  balance: number;        // ç•¶å‰é¤˜é¡
  isDefault: boolean;     // æ˜¯å¦ç‚ºé è¨­å¸³æˆ¶ï¼ˆæ™ºèƒ½é è¨­ç”¨ï¼‰
  icon?: string;          // åœ–ç¤º
  createdAt: Date;
}
```

**è³‡æ–™åº« Schema æ›´æ–°**ï¼š

```prisma
model User {
  id        String   @id @default(cuid())
  // ... å…¶ä»–æ¬„ä½
  
  // ğŸ¯ æŠ•è³‡ç¯„åœè¨­å®šï¼ˆæ¼¸é€²å¼æ­éœ²ï¼‰
  enableTWStock   Boolean @default(true)  // å°è‚¡
  enableUSStock   Boolean @default(false) // ç¾è‚¡
  enableCrypto    Boolean @default(false) // åŠ å¯†è²¨å¹£
  
  accounts  Account[]
  assets    Asset[]
}

model Account {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  name        String   // "å°æ–°éŠ€è¡Œ", "Firstrade", "åœ‹æ³°è¤‡å§”è¨—", "å¹£å®‰"
  type        String   // 'CASH' | 'BANK' | 'BROKERAGE' | 'EXCHANGE'
  currency    String   @default("TWD")
  balance     Float    @default(0)
  isDefault   Boolean  @default(false) // ğŸ¯ æ™ºèƒ½é è¨­å¸³æˆ¶
  isSub       Boolean  @default(false) // ğŸ‡¹ğŸ‡¼ æ˜¯å¦ç‚ºè¤‡å§”è¨—å¸³æˆ¶
  icon        String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // é—œè¯
  transactions Transaction[]
  transfersFrom Transfer[] @relation("FromAccount")
  transfersTo   Transfer[] @relation("ToAccount")
  incomingTransfers Transaction[] @relation("TransferTarget")
  
  @@index([userId])
  @@index([userId, type]) // æŸ¥è©¢ç‰¹å®šé¡å‹å¸³æˆ¶æ™‚å„ªåŒ–
}

model Transaction {
  id         String   @id @default(cuid())
  userId     String
  
  accountId  String   // â† ä¸»è¦å¸³æˆ¶ï¼ˆæ‰£æ¬¾ä¾†æºï¼‰
  account    Account  @relation(fields: [accountId], references: [id])
  
  // å¦‚æœæ˜¯è½‰å¸³é¡å‹ï¼ˆType = TRANSFERï¼‰
  toAccountId String?
  toAccount   Account? @relation("TransferTarget", fields: [toAccountId], references: [id])
  
  date       DateTime
  type       String   // 'income' | 'expense' | 'transfer' | 'stock_buy' | 'stock_sell'
  amount     Float
  category   String
  note       String?
  
  // é‚è¼¯èªªæ˜ï¼š
  // Expense:   account.balance -= amount
  // Income:    account.balance += amount
  // Transfer:  account.balance -= amount, toAccount.balance += amount
  // StockBuy:  account.balance -= amount (åŒæ™‚ Asset å¢åŠ )
  // StockSell: account.balance += amount (åŒæ™‚ Asset æ¸›å°‘)
  
  createdAt  DateTime @default(now())
  
  @@index([userId])
  @@index([accountId])
}

model Transfer {
  id            String   @id @default(cuid())
  userId        String
  
  fromAccountId String
  fromAccount   Account  @relation("FromAccount", fields: [fromAccountId], references: [id])
  
  toAccountId   String
  toAccount     Account  @relation("ToAccount", fields: [toAccountId], references: [id])
  
  amount        Float
  exchangeRate  Float?   // å¦‚æœè·¨å¹£åˆ¥ï¼ˆä¾‹ï¼š29.5 TWD/USDï¼‰
  fee           Float?   // æ‰‹çºŒè²»
  note          String?
  date          DateTime
  
  createdAt     DateTime @default(now())
  
  @@index([userId])
  @@index([fromAccountId])
  @@index([toAccountId])
}
```

**ä½¿ç”¨è€…æµç¨‹æ›´æ–°**ï¼š

```
ã€æƒ…å¢ƒ 1ï¼šæ™ºèƒ½é è¨­å¸³æˆ¶é‚è¼¯ã€‘

// ä¸€èˆ¬è¨˜å¸³ï¼ˆæ”¯å‡º/æ”¶å…¥ï¼‰
ç”¨æˆ¶ï¼š-120 é£²é£Ÿ åˆé¤
    â†“
ç³»çµ±è‡ªå‹•é¸æ“‡ isDefault=true çš„å¸³æˆ¶ï¼ˆä¾‹å¦‚ã€ŒéŒ¢åŒ…ã€ï¼‰
    â†“
Botï¼šã€Œâœ… å·²è¨˜å¸³
     ğŸ’° éŒ¢åŒ… -NT$120 (é£²é£Ÿ)
     é¤˜é¡ï¼šNT$4,880
     
     ğŸ“ é»æ“Šä¿®æ”¹å¸³æˆ¶ã€

// è²·è³£è‚¡ç¥¨ï¼ˆæ”¯æ´è¤‡å§”è¨—ï¼‰
ç”¨æˆ¶ï¼šè²·å…¥ AAPL 10è‚¡ 180
    â†“
ç³»çµ±æ™ºèƒ½é¸æ“‡ï¼ˆè¤‡å§”è¨—å„ªå…ˆé‚è¼¯ï¼‰ï¼š
1. å¦‚æœæ˜¯ç¾è‚¡ä»£ç¢¼ï¼š
   a. å„ªå…ˆæ‰¾ currency='USD' çš„ BROKERAGE å¸³æˆ¶ï¼ˆFirstrade/IBï¼‰
   b. å¦‚æœæ²’æœ‰ â†’ æ‰¾ currency='TWD' çš„ BROKERAGEï¼ˆè¦–ç‚ºè¤‡å§”è¨—ï¼‰
   c. å¦‚æœéƒ½æ²’æœ‰ â†’ æç¤ºå»ºç«‹å¸³æˆ¶

2. å¦‚æœæ˜¯å°è‚¡ä»£ç¢¼ï¼š
   a. åªå…è¨± currency='TWD' çš„ BROKERAGE å¸³æˆ¶
   b. å¦‚æœæ²’æœ‰ â†’ æç¤ºå»ºç«‹å°è‚¡è­‰åˆ¸æˆ¶
    â†“

// æƒ…å¢ƒ Aï¼šæœ‰ç¾é‡‘å¸³æˆ¶ï¼ˆç›´æ¥æ‰£ç¾é‡‘ï¼‰
Botï¼šã€ŒğŸ’° æ‰£æ¬¾å¸³æˆ¶ï¼šFirstrade (USD)
     é¤˜é¡ï¼š$5,230
     éœ€è¦ï¼š$1,800
     
     [ç¢ºèªè²·å…¥] [æ›å¸³æˆ¶]ã€

// æƒ…å¢ƒ Bï¼šåªæœ‰å°å¹£å¸³æˆ¶ï¼ˆè¤‡å§”è¨—æ›åŒ¯ï¼‰
Botï¼šã€ŒğŸ’° æ‰£æ¬¾å¸³æˆ¶ï¼šåœ‹æ³°è­‰åˆ¸ (TWD)
     é¤˜é¡ï¼šNT$300,000
     éœ€è¦ï¼šUS$1,800 â‰ˆ NT$58,950 ğŸ’±
     (åŒ¯ç‡ 1 USD = 32.75 TWD)
     
     âš ï¸ å°‡ä»¥è¤‡å§”è¨—æ–¹å¼ä¸‹å–®
     å¯¦éš›æˆäº¤åŒ¯ç‡ä»¥åˆ¸å•†ç‚ºæº–
     
     [ç¢ºèªè²·å…¥] [æ›å¸³æˆ¶]ã€

```
ã€æƒ…å¢ƒ 2ï¼šå…¥é‡‘åˆ°è­‰åˆ¸æˆ¶ï¼ˆè½‰å¸³æµç¨‹ï¼‰ã€‘
LINE Botï¼šã€Œè½‰å¸³ã€
    â†“
Botï¼šã€Œå¾å“ªå€‹å¸³æˆ¶ï¼Ÿã€
     [å°æ–°éŠ€è¡Œ] [éƒµå±€] [æ–°å¢å¸³æˆ¶]
    â†“
ç”¨æˆ¶ï¼šé»æ“Š [å°æ–°éŠ€è¡Œ]
    â†“
Botï¼šã€Œè½‰åˆ°å“ªå€‹å¸³æˆ¶ï¼Ÿã€
     [ğŸ‡ºğŸ‡¸ Firstrade] [å¯Œé‚¦è­‰åˆ¸] [æ–°å¢å¸³æˆ¶]
    â†“
ç”¨æˆ¶ï¼šé»æ“Š [Firstrade]
    â†“
Botï¼šã€Œè«‹è¼¸å…¥é‡‘é¡ï¼ˆä¾‹å¦‚ï¼š30000ï¼‰ã€
    â†“
ç”¨æˆ¶ï¼š30000
    â†“
ç³»çµ±æª¢æ¸¬åˆ°è·¨å¹£åˆ¥è½‰å¸³ï¼ˆTWD â†’ USDï¼‰
    â†“
Botï¼šã€ŒğŸ’± éœ€è¦æ›åŒ¯
     NT$30,000 â†’ ç´„ $930 USD
     åŒ¯ç‡ï¼š1 USD = 32.26 TWD
     
     [ç¢ºèªè½‰å¸³] [ä¿®æ”¹é‡‘é¡]ã€
    â†“
ç”¨æˆ¶ï¼š[ç¢ºèªè½‰å¸³]
    â†“
Botï¼šã€Œâœ… è½‰å¸³æˆåŠŸ
     å°æ–°éŠ€è¡Œ â†’ Firstrade
     é‡‘é¡ï¼šNT$30,000 ($930 USD)
     
     é¤˜é¡ï¼š
     â€¢ å°æ–°éŠ€è¡Œï¼šNT$270,000
     â€¢ Firstradeï¼š$5,160 USDã€
```

```
ã€æƒ…å¢ƒ 2ï¼šè²·è‚¡ç¥¨æ™‚æª¢æŸ¥é¤˜é¡ã€‘
Web è²·è‚¡ç¥¨è¦–çª—ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è²·å…¥è‚¡ç¥¨ (Buy Stock)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è‚¡ç¥¨ä»£ç¢¼: TSLA                       â”‚
â”‚ ç•¶å‰åƒ¹æ ¼: $243.50                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰£æ¬¾å¸³æˆ¶ (Payment Source)            â”‚
â”‚ [ ğŸ‡ºğŸ‡¸ Firstrade (USD) â–¼ ]          â”‚
â”‚ ğŸ’° é¤˜é¡: $5,230.50 (è³¼è²·åŠ›)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è²·å…¥æ•¸é‡: 10 è‚¡                      â”‚
â”‚ è²·å…¥åƒ¹æ ¼: $243.50                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é ä¼°ç¸½æˆæœ¬: $2,435.00                â”‚
â”‚ ğŸ’µ äº¤æ˜“å¾Œé¤˜é¡: $2,795.50             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [âœ… ç¢ºèªè²·å…¥]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// é‚è¼¯æª¢æŸ¥ï¼š
if (totalCost > account.balance) {
  showError("é¤˜é¡ä¸è¶³");
  disableBuyButton();
}
```

```
ã€æƒ…å¢ƒ 3ï¼šLINE Bot è²·è‚¡ç¥¨æª¢æŸ¥é¤˜é¡ã€‘
ç”¨æˆ¶ï¼šã€Œè²·å…¥ 2330 100è‚¡ 650ã€
    â†“
ç³»çµ±è¨ˆç®—ï¼š100 Ã— 650 = NT$65,000
    â†“
æª¢æŸ¥é è¨­è­‰åˆ¸æˆ¶ï¼ˆå¯Œé‚¦è­‰åˆ¸ï¼‰é¤˜é¡ï¼šNT$50,000
    â†“
é¤˜é¡ä¸è¶³ï¼
    â†“
Botï¼šã€Œâš ï¸ è³‡é‡‘ä¸è¶³
     éœ€è¦ï¼šNT$65,000
     å¯Œé‚¦è­‰åˆ¸å¯ç”¨ï¼šNT$50,000
     ä¸è¶³ï¼šNT$15,000
     
     ğŸ’¡ æ‚¨å¯ä»¥ï¼š
     1ï¸âƒ£ è¨˜éŒ„å…¥é‡‘åˆ°å¯Œé‚¦è­‰åˆ¸
     2ï¸âƒ£ ä¿®æ”¹è²·å…¥æ•¸é‡ç‚º 76 è‚¡
     3ï¸âƒ£ å–æ¶ˆæœ¬æ¬¡äº¤æ˜“
     
     [æˆ‘å·²å…¥é‡‘] [æ¸›å°‘æ•¸é‡] [å–æ¶ˆ]ã€
```

**Dashboard é¡¯ç¤ºæ›´æ–°**ï¼š

```tsx
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¸½æ·¨è³‡ç”¢ (Net Worth)                 â”‚
â”‚ NT$ 1,234,567                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’° ç¾é‡‘/å­˜æ¬¾     â”‚ ğŸ“ˆ æŠ•è³‡éƒ¨ä½        â”‚
â”‚ NT$ 434,567     â”‚ NT$ 800,000       â”‚
â”‚ (å¯ç”¨è³¼è²·åŠ›)     â”‚ (è‚¡ç¥¨+åŠ å¯†è²¨å¹£)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                     â”‚
â”‚ ğŸ“Š å¸³æˆ¶æ˜ç´°                          â”‚
â”‚ â”œâ”€ ğŸ¦ å°æ–°éŠ€è¡Œï¼šNT$300,000          â”‚
â”‚ â”œâ”€ ğŸ‡ºğŸ‡¸ Firstradeï¼š$4,520 (USD)     â”‚
â”‚ â””â”€ â‚¿ å¹£å®‰ï¼š$1,230 (USDT)            â”‚
â”‚                                     â”‚
â”‚ ğŸ“ˆ æŒè‚¡éƒ¨ä½                          â”‚
â”‚ â”œâ”€ TSLAï¼š$28,500 (+12.3%)          â”‚
â”‚ â”œâ”€ å°ç©é›»ï¼šNT$450,000 (+8.5%)       â”‚
â”‚ â””â”€ BTCï¼š$321,500 (+45.2%)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// UI é‚è¼¯ï¼š
// ç¾é‡‘/å­˜æ¬¾ = SUM(Account.balance WHERE type IN ['CASH', 'BANK'])
// æŠ•è³‡éƒ¨ä½ = SUM(Asset.currentValue)
```

```
ã€æƒ…å¢ƒ 3ï¼šå®Œæ•´æµç¨‹ - å¾ç™¼è–ªæ°´åˆ°è²·ç¾è‚¡ã€‘

1ï¸âƒ£ å…¥é‡‘ï¼ˆIncomeï¼‰
   ç”¨æˆ¶ï¼š+50000 è–ªæ°´
   ç³»çµ±ï¼šå­˜å…¥é è¨­å¸³æˆ¶ [ğŸ‡¹ğŸ‡¼ å°æ–°éŠ€è¡Œ]
   çµæœï¼šå°æ–°éŠ€è¡Œ +NT$50,000

2ï¸âƒ£ æ›åŒ¯/è½‰å¸³ï¼ˆTransferï¼‰
   ç”¨æˆ¶ï¼šè½‰å¸³
   ç³»çµ±ï¼šå¾ [å°æ–°éŠ€è¡Œ] â†’ [Firstrade]
   é‡‘é¡ï¼šNT$30,000 â†’ $930 USD (åŒ¯ç‡ 32.26)
   çµæœï¼š
   â€¢ å°æ–°éŠ€è¡Œ -NT$30,000
   â€¢ Firstrade +$930 USD

3ï¸âƒ£ æŠ•è³‡ï¼ˆStock Buyï¼‰
   ç”¨æˆ¶ï¼šè²·å…¥ TSLA 3è‚¡ 243.5
   ç³»çµ±ï¼šè‡ªå‹•é¸æ“‡ [Firstrade] (å› ç‚ºæ˜¯ç¾è‚¡)
   é¡¯ç¤ºï¼šğŸ’° é¤˜é¡ $930 â†’ éœ€è¦ $730.50
   çµæœï¼š
   â€¢ Firstrade -$730.50
   â€¢ æŒè‚¡ +3è‚¡ TSLA
   â€¢ é¤˜é¡é¡¯ç¤ºï¼š$199.50 å‰©é¤˜

âœ… è³‡ç”¢é–‰ç’°å®Œæˆï¼š
   ç¾é‡‘ $50,000 â†’ å°æ–° $20,000 + Firstrade $199.50 + TSLA $730.50
   ç¸½è³‡ç”¢ä¸è®Šï¼Œåªæ˜¯é…ç½®æ”¹è®Š âœ¨
```

---

### å•é¡Œ 2ï¼šæ‰‹å‹•è¼¸å…¥çš„ç–²å‹æ„Ÿ ğŸŸ¡ Important

#### **å•é¡Œæè¿°**

å®šæœŸå®šé¡æŠ•è³‡éœ€è¦æ¯å€‹æœˆæ‰‹å‹•è¼¸å…¥ï¼š
```
ä½¿ç”¨è€…å¿ƒç†ï¼š
ç¬¬ 1 å€‹æœˆï¼šã€Œå—¯ä¸éŒ¯ï¼Œè¨˜éŒ„ä¸€ä¸‹ã€
ç¬¬ 2 å€‹æœˆï¼šã€Œé‚„å¥½å•¦ã€
ç¬¬ 3 å€‹æœˆï¼šã€Œæœ‰é»ç…©ã€
ç¬¬ 4 å€‹æœˆï¼šã€Œç®—äº†ä¸è¨˜äº†ã€â† æµå¤±ï¼
```

#### **è§£æ±ºæ–¹æ¡ˆï¼šå®šæœŸæŠ•è³‡æ¨¡æ¿**

**æ–°å¢ RecurringTransaction æ¨¡å‹**ï¼š

```prisma
model RecurringTransaction {
  id        String   @id @default(cuid())
  userId    String
  
  // äº¤æ˜“å…§å®¹
  type      String   // 'stock_buy' | 'expense' | 'income'
  symbol    String?  // è‚¡ç¥¨ä»£ç¢¼ï¼ˆå¦‚æœæ˜¯è²·è‚¡ç¥¨ï¼‰
  amount    Float    // é‡‘é¡æˆ–æ•¸é‡
  price     Float?   // é è¨­åƒ¹æ ¼ï¼ˆå¯é¸ï¼‰
  category  String?  // åˆ†é¡ï¼ˆå¦‚æœæ˜¯è¨˜å¸³ï¼‰
  note      String?
  
  // é€±æœŸè¨­å®š
  frequency String   // 'daily' | 'weekly' | 'monthly' | 'yearly'
  dayOfMonth Int?    // æ¯æœˆå¹¾è™Ÿï¼ˆ1-31ï¼‰
  dayOfWeek  Int?    // æ˜ŸæœŸå¹¾ï¼ˆ1-7ï¼‰
  
  // æé†’è¨­å®š
  reminderTime String? // "09:00"
  autoExecute  Boolean @default(false) // è‡ªå‹•åŸ·è¡Œæˆ–åªæé†’
  
  // ç‹€æ…‹
  isActive     Boolean @default(true)
  startDate    DateTime
  endDate      DateTime?
  lastExecuted DateTime?
  
  createdAt DateTime @default(now())
}
```

**ä½¿ç”¨è€…æµç¨‹**ï¼š

```
ã€è¨­å®šå®šæœŸå®šé¡ã€‘
LINE Botï¼šã€Œå®šæœŸå®šé¡ã€
    â†“
Botï¼šã€Œè«‹é¸æ“‡é¡å‹ã€
     [ğŸ“ˆ å®šæœŸè²·è‚¡] [ğŸ’¸ å›ºå®šæ”¯å‡º] [ğŸ’° å›ºå®šæ”¶å…¥]
    â†“
ç”¨æˆ¶ï¼šé»æ“Š [å®šæœŸè²·è‚¡]
    â†“
Botï¼šã€Œè«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼š2330ï¼‰ã€
    â†“
ç”¨æˆ¶ï¼š2330
    â†“
Botï¼šã€Œæ¯æœˆè²·å…¥å¤šå°‘è‚¡ï¼Ÿï¼ˆä¾‹å¦‚ï¼š10ï¼‰ã€
    â†“
ç”¨æˆ¶ï¼š10
    â†“
Botï¼šã€Œæ¯æœˆå¹¾è™Ÿæé†’ï¼Ÿï¼ˆ1-31ï¼‰ã€
    â†“
ç”¨æˆ¶ï¼š6
    â†“
Botï¼šã€Œâœ… å·²è¨­å®šå®šæœŸå®šé¡
     â€¢ è‚¡ç¥¨ï¼š2330.TW
     â€¢ æ•¸é‡ï¼š10 è‚¡
     â€¢ é€±æœŸï¼šæ¯æœˆ 6 è™Ÿ
     
     ä¸‹æ¬¡åŸ·è¡Œï¼š2024-12-06
     
     åˆ°æ™‚æœƒæé†’ä½ è¨˜éŒ„ï¼ã€
```

```
ã€åˆ°æœŸè‡ªå‹•æé†’ã€‘
12/6 æ—©ä¸Š 9:00
Bot æ¨æ’­ï¼š
ã€Œâ° å®šæœŸå®šé¡æé†’
 
 ğŸ“ˆ è²·å…¥ 2330.TW
 â€¢ æ•¸é‡ï¼š10 è‚¡
 â€¢ ç•¶å‰åƒ¹æ ¼ï¼šNT$650
 â€¢ é ä¼°æˆæœ¬ï¼šNT$6,500
 
 æ˜¯å¦å·²å®Œæˆè²·å…¥ï¼Ÿ
 [âœ… æ˜¯ï¼Œä»¥å¸‚åƒ¹è¨˜éŒ„]
 [âœï¸ æ˜¯ï¼Œæ‰‹å‹•è¼¸å…¥åƒ¹æ ¼]
 [â­ è·³éæœ¬æœˆ]
 [ğŸ—‘ å–æ¶ˆå®šæœŸå®šé¡]ã€
    â†“
ç”¨æˆ¶ï¼šé»æ“Š [æ˜¯ï¼Œä»¥å¸‚åƒ¹è¨˜éŒ„]
    â†“
Botï¼šã€Œâœ… å·²è¨˜éŒ„è²·å…¥
     2330.TW Ã— 10 @ NT$650
     ç¸½æˆæœ¬ï¼šNT$6,500
     
     ä¸‹æ¬¡æé†’ï¼š2025-01-06ã€
```

**Web ç®¡ç†ä»‹é¢**ï¼š

```tsx
<RecurringTransactionList>
  <RecurringItem>
    <div className="icon">ğŸ“ˆ</div>
    <div className="info">
      <h3>å®šæœŸè²·å…¥ 2330.TW</h3>
      <p>æ¯æœˆ 6 è™Ÿ â€¢ 10 è‚¡</p>
    </div>
    <div className="status">
      <span>å·²åŸ·è¡Œ 3 æ¬¡</span>
      <Toggle checked={isActive} />
    </div>
    <button>ç·¨è¼¯</button>
  </RecurringItem>
  
  <RecurringItem>
    <div className="icon">ğŸ’¸</div>
    <div className="info">
      <h3>æˆ¿ç§Ÿ</h3>
      <p>æ¯æœˆ 1 è™Ÿ â€¢ NT$15,000</p>
    </div>
    <div className="status">
      <span>å·²åŸ·è¡Œ 12 æ¬¡</span>
      <Toggle checked={isActive} />
    </div>
    <button>ç·¨è¼¯</button>
  </RecurringItem>
</RecurringTransactionList>
```

---

### å•é¡Œ 3ï¼šåŒ¯ç‡çš„é»‘é­”æ³• ğŸŸ¡ Important

#### **å•é¡Œæè¿°**

```
æƒ…å¢ƒï¼š
æ—©ä¸Šï¼šåˆé¤ -NT$120
ä¸‹åˆï¼šè²· AAPL 10è‚¡ @ $150 = $1,500
æ™šä¸Šï¼šDashboard ç¸½æ”¯å‡ºæ˜¯ï¼Ÿ

âŒ éŒ¯èª¤åšæ³•ï¼š
å­˜å…¥æ™‚å°±è½‰æ›ï¼š$1,500 Ã— 31 = NT$46,500
æ˜å¤©åŒ¯ç‡è®Šæˆ 32 â†’ è³‡ç”¢åƒ¹å€¼å¤±çœŸ
ç„¡æ³•é‚„åŸåŸå§‹å¹£åˆ¥

âœ… æ­£ç¢ºåšæ³•ï¼š
å­˜åŸå§‹å¹£åˆ¥ï¼š$1,500 (currency: USD)
é¡¯ç¤ºæ™‚å³æ™‚è½‰æ›ï¼š$1,500 Ã— å³æ™‚åŒ¯ç‡
```

#### **è§£æ±ºæ–¹æ¡ˆï¼šMulti-Currency æ¶æ§‹**

**Transaction Schema æ›´æ–°**ï¼š

```prisma
model Transaction {
  id         String   @id @default(cuid())
  userId     String
  accountId  String?
  
  date       DateTime
  type       String
  
  // åŸå§‹é‡‘é¡ï¼ˆä¸å¯è®Šï¼‰
  amount          Float
  originalCurrency String @default("TWD")  // â† æ–°å¢ï¼
  
  // å¿«å–çš„ TWD é‡‘é¡ï¼ˆå¯æ›´æ–°ï¼‰
  amountTWD       Float?                   // â† æ–°å¢ï¼
  exchangeRate    Float?                   // â† æ–°å¢ï¼
  rateUpdatedAt   DateTime?                // â† æ–°å¢ï¼
  
  category   String
  note       String?
  
  createdAt  DateTime @default(now())
}

model Asset {
  id        String   @id @default(cuid())
  userId    String
  
  symbol    String
  type      String
  quantity  Float
  
  // åŸå§‹æˆæœ¬ï¼ˆä¸å¯è®Šï¼‰
  avgPrice        Float
  avgCurrency     String  @default("USD")  // â† æ–°å¢ï¼
  
  // å³æ™‚åƒ¹æ ¼ï¼ˆå¯æ›´æ–°ï¼‰
  currentPrice    Float
  currentCurrency String  @default("USD")  // â† æ–°å¢ï¼
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

**åŒ¯ç‡æœå‹™**ï¼š

```typescript
// services/exchangeRateService.ts
import axios from 'axios';

interface ExchangeRate {
  from: string;
  to: string;
  rate: number;
  timestamp: Date;
}

class ExchangeRateService {
  private cache: Map<string, ExchangeRate> = new Map();
  private cacheExpiry = 3600000; // 1 å°æ™‚
  
  async getRate(from: string, to: string): Promise<number> {
    if (from === to) return 1;
    
    const key = `${from}_${to}`;
    const cached = this.cache.get(key);
    
    // æª¢æŸ¥å¿«å–
    if (cached && Date.now() - cached.timestamp.getTime() < this.cacheExpiry) {
      return cached.rate;
    }
    
    // èª¿ç”¨åŒ¯ç‡ API
    const rate = await this.fetchRate(from, to);
    
    this.cache.set(key, {
      from,
      to,
      rate,
      timestamp: new Date()
    });
    
    return rate;
  }
  
  private async fetchRate(from: string, to: string): Promise<number> {
    // ä½¿ç”¨å…è²»åŒ¯ç‡ API
    // https://exchangerate-api.com/ æˆ–
    // https://www.exchangerate-api.com/
    
    const response = await axios.get(
      `https://api.exchangerate-api.com/v4/latest/${from}`
    );
    
    return response.data.rates[to];
  }
  
  // æ‰¹é‡è½‰æ›
  async convertToTWD(amount: number, currency: string): Promise<number> {
    if (currency === 'TWD') return amount;
    const rate = await this.getRate(currency, 'TWD');
    return amount * rate;
  }
}

export const exchangeRateService = new ExchangeRateService();
```

**Dashboard é¡¯ç¤ºé‚è¼¯**ï¼š

```typescript
// è¨ˆç®—ç¸½è³‡ç”¢ï¼ˆå³æ™‚è½‰æ›ï¼‰
const calculateTotalAssets = async (userId: string) => {
  // 1. å–å¾—æ‰€æœ‰äº¤æ˜“è¨˜éŒ„
  const transactions = await prisma.transaction.findMany({ 
    where: { userId } 
  });
  
  // 2. å–å¾—æ‰€æœ‰æŒè‚¡
  const assets = await prisma.asset.findMany({ 
    where: { userId } 
  });
  
  // 3. è½‰æ›æˆ TWD
  let totalTWD = 0;
  
  // ç¾é‡‘é¤˜é¡
  for (const tx of transactions) {
    const amountTWD = await exchangeRateService.convertToTWD(
      tx.amount, 
      tx.originalCurrency
    );
    totalTWD += tx.type === 'income' ? amountTWD : -amountTWD;
  }
  
  // è‚¡ç¥¨å¸‚å€¼
  for (const asset of assets) {
    const marketValue = asset.currentPrice * asset.quantity;
    const marketValueTWD = await exchangeRateService.convertToTWD(
      marketValue,
      asset.currentCurrency
    );
    totalTWD += marketValueTWD;
  }
  
  return {
    totalTWD,
    breakdown: {
      cash: cashTWD,
      stocks: stocksTWD,
      crypto: cryptoTWD
    }
  };
};
```

**UI é¡¯ç¤º**ï¼š

```tsx
<AssetCard asset={asset}>
  {/* åŸå§‹å¹£åˆ¥ */}
  <div className="price-original">
    ${asset.currentPrice.toFixed(2)} USD
  </div>
  
  {/* è½‰æ›å¾Œé¡¯ç¤º */}
  <div className="price-converted text-ink-400 text-sm">
    â‰ˆ NT${(asset.currentPrice * exchangeRate).toFixed(0)}
  </div>
  
  {/* åŒ¯ç‡è¨»è¨˜ */}
  <div className="exchange-rate text-xs text-ink-300">
    åŒ¯ç‡ï¼š1 USD = {exchangeRate.toFixed(2)} TWD
    <span className="ml-2">æ›´æ–°æ–¼ {formatTime(rateUpdatedAt)}</span>
  </div>
</AssetCard>
```

**åå¥½è¨­å®š**ï¼š

```tsx
<Settings>
  <Section title="é¡¯ç¤ºåå¥½">
    <Select 
      label="ä¸»è¦å¹£åˆ¥" 
      value={baseCurrency}
      onChange={setBaseCurrency}
    >
      <option value="TWD">æ–°å°å¹£ (NT$)</option>
      <option value="USD">ç¾é‡‘ ($)</option>
      <option value="CNY">äººæ°‘å¹£ (Â¥)</option>
    </Select>
    
    <Toggle
      label="é¡¯ç¤ºåŸå§‹å¹£åˆ¥"
      checked={showOriginalCurrency}
      onChange={setShowOriginalCurrency}
    />
    
    <Toggle
      label="è‡ªå‹•æ›´æ–°åŒ¯ç‡"
      checked={autoUpdateRates}
      onChange={setAutoUpdateRates}
    />
  </Section>
</Settings>
```

---

## ğŸ”„ Migration Planï¼ˆè³‡æ–™é·ç§»è¨ˆåŠƒï¼‰

### Step 1: æ–°å¢ Account è¡¨

```sql
-- ç‚ºç¾æœ‰ç”¨æˆ¶å»ºç«‹é è¨­å¸³æˆ¶
INSERT INTO Account (userId, name, type, currency, balance)
SELECT 
  id as userId,
  'ç¾é‡‘å¸³æˆ¶' as name,
  'bank' as type,
  'TWD' as currency,
  0 as balance
FROM User;
```

### Step 2: é·ç§»ç¾æœ‰äº¤æ˜“è¨˜éŒ„

```sql
-- å°‡æ‰€æœ‰äº¤æ˜“ç¶å®šåˆ°é è¨­å¸³æˆ¶
UPDATE Transaction 
SET accountId = (
  SELECT id FROM Account 
  WHERE Account.userId = Transaction.userId 
  AND Account.name = 'ç¾é‡‘å¸³æˆ¶'
)
WHERE accountId IS NULL;
```

### Step 3: å›å¡« originalCurrency

```sql
-- å°è‚¡ â†’ TWD
UPDATE Transaction 
SET originalCurrency = 'TWD'
WHERE category LIKE '%å°è‚¡%' OR note LIKE '%NT$%';

-- ç¾è‚¡ â†’ USD
UPDATE Transaction 
SET originalCurrency = 'USD'
WHERE category LIKE '%ç¾è‚¡%' OR note LIKE '%$%' AND note NOT LIKE '%NT$%';

-- å…¶é¤˜é è¨­ TWD
UPDATE Transaction 
SET originalCurrency = 'TWD'
WHERE originalCurrency IS NULL;
```

---

## ğŸ“‹ Updated Implementation Checklist

### Phase 2: UX å„ªåŒ–ï¼ˆæ›´æ–°ï¼‰

#### **P0 - Criticalï¼ˆç«‹å³å¯¦ä½œï¼‰**

- [x] åˆä½µ Dashboard + Portfolio
- [x] å€‹è‚¡è©³æƒ… Modal
- [x] å¿«é€Ÿè¨˜å¸³è¼¸å…¥æ¡†
- [ ] **Account Systemï¼ˆå¸³æˆ¶ç³»çµ±ï¼‰** ğŸ†•
  - [ ] Account è³‡æ–™æ¨¡å‹
  - [ ] Transfer è½‰å¸³åŠŸèƒ½
  - [ ] å¸³æˆ¶é¤˜é¡è¿½è¹¤
  - [ ] è²·è‚¡ç¥¨æ™‚æª¢æŸ¥é¤˜é¡
- [ ] **Multi-Currency Supportï¼ˆå¤šå¹£åˆ¥ï¼‰** ğŸ†•
  - [ ] å­˜å„²åŸå§‹å¹£åˆ¥
  - [ ] åŒ¯ç‡æœå‹™æ•´åˆ
  - [ ] å³æ™‚è½‰æ›é¡¯ç¤º
  - [ ] å¹£åˆ¥åå¥½è¨­å®š
- [ ] BuyStockModal çµ„ä»¶
- [ ] è²·å…¥/è³£å‡º API

#### **P1 - Importantï¼ˆçŸ­æœŸå„ªåŒ–ï¼‰**

- [ ] **Recurring Transactionsï¼ˆå®šæœŸäº¤æ˜“ï¼‰** ğŸ†•
  - [ ] å®šæœŸå®šé¡æ¨¡å‹
  - [ ] æé†’ç³»çµ±
  - [ ] ç®¡ç†ä»‹é¢
  - [ ] LINE Bot æ•´åˆ
- [ ] ç©ºç‹€æ…‹å¼•å°
- [ ] æ™ºèƒ½åˆ†é¡é æ¸¬

---

## ğŸ“ é™„éŒ„

### ç›¸é—œæ–‡ä»¶

- [UX_IMPROVEMENT_PLAN.md](./UX_IMPROVEMENT_PLAN.md) - è©³ç´° UX æ”¹é€²æ–¹æ¡ˆ
- [STOCK_PURCHASE_FLOW.md](./STOCK_PURCHASE_FLOW.md) - è²·è‚¡ç¥¨æµç¨‹è¨­è¨ˆ
- [LEDGER_REDESIGN.md](./LEDGER_REDESIGN.md) - è¨˜å¸³é é¢ç°¡åŒ–æ–¹æ¡ˆ
- [LIFF_INTEGRATION_GUIDE.md](./LIFF_INTEGRATION_GUIDE.md) - LIFF æ•´åˆæ•™å­¸
- [LINEBOT_ARCHITECTURE.md](./LINEBOT_ARCHITECTURE.md) - LINE Bot æŠ€è¡“æ¶æ§‹

### è¨­è¨ˆåŸå‰‡

1. **å¿«é€Ÿè¼¸å…¥ï¼Œæ·±åº¦åˆ†æ** - LINE Bot å¿«é€Ÿè¨˜éŒ„ï¼ŒWeb è©³ç´°æŸ¥çœ‹
2. **ä¸€æ¬¡è¨˜éŒ„ï¼Œå…©ç«¯åŒæ­¥** - è³‡æ–™å³æ™‚åŒæ­¥
3. **æ¸›å°‘é»æ“Šï¼Œå¢åŠ æ·±åº¦** - åˆä½µé é¢ï¼ŒåŠŸèƒ½ä¸‹æ²‰
4. **æ™ºèƒ½é æ¸¬ï¼Œé™ä½é¸æ“‡** - æ©Ÿå™¨å­¸ç¿’è¼”åŠ©
5. **å¼•å°è€Œéå¼·åˆ¶** - å‹å–„çš„ç©ºç‹€æ…‹å’ŒéŒ¯èª¤æç¤º

### Morandi é…è‰²ç³»çµ±

```css
/* ä¸»è‰²èª¿ */
--morandi-blue: #8FA5B5;      /* éœ§éœ¾è— - ä¸»è¦æ“ä½œ */
--morandi-sage: #A8B9A5;      /* é¼ å°¾è‰ç¶  - æ”¶å…¥/ç›ˆåˆ© */
--morandi-rose: #C8A4A4;      /* ç«ç‘°ç° - æ”¯å‡º/è™§æ */
--morandi-clay: #B8A293;      /* èµ¤é™¶åœŸ - å¼·èª¿ */
--morandi-sand: #E6DFD0;      /* æ²™ç±³è‰² - èƒŒæ™¯ */

/* è¼”åŠ©è‰² */
--morandi-blueLight: #C8D5E0;
--morandi-sageLight: #D4E0D2;
--morandi-roseLight: #E6D4D4;
--morandi-clayLight: #D9CFC5;

/* ä¸­æ€§è‰² */
--ink-900: #2C2C2C;           /* æ·±å¢¨ - æ¨™é¡Œ */
--ink-700: #4A4A4A;           /* å¢¨ç° - å…§æ–‡ */
--ink-400: #9CA3AF;           /* æ·ºå¢¨ - æ¬¡è¦æ–‡å­— */
--paper: #F9F7F2;             /* ç´™å¼µ - åº•è‰² */
```

---

**æ–‡ä»¶ç‰ˆæœ¬**: 2.0  
**æœ€å¾Œæ›´æ–°**: 2024-11-24  
**ç¶­è­·è€…**: SmartCapital åœ˜éšŠ  
**æˆæ¬Š**: MIT License
